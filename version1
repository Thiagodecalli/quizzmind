<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototipo QuizMind v2</title>
    <!-- Incluyendo Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- ESTILOS COMPARTIDOS (Estilo Windows Clásico) --- */
        
        /* Ocultar vistas no activas */
        .view {
            display: none;
        }
        .view.active {
            display: block;
        }
        
        /* Contenedor de la ventana de aplicación */
        #consultar-view-container, #registro-view-container {
            font-family: 'Tahoma', 'MS Sans Serif', Arial, sans-serif;
            font-size: 11px;
            background-color: #ECE9D8; /* Color de fondo de ventana clásico */
            border: 1px solid #000;
            width: 800px; 
            margin: 2rem auto;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.3);
        }

        /* Barra de título azul */
        .window-title-bar {
            background: linear-gradient(to right, #0058A8, #A6CAF0);
            padding: 4px 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #000;
        }
        .window-title-bar h1 {
            color: white;
            font-weight: bold;
            font-size: 12px;
            margin: 0;
        }
        /* Botones falsos de min/max/cerrar */
        .window-controls {
            display: flex;
            gap: 2px;
        }
        .window-controls span {
            width: 18px;
            height: 18px;
            background-color: #ECE9D8;
            border: 1px solid #666;
            font-family: 'Webdings', 'Marlett';
            font-size: 12px;
            text-align: center;
            line-height: 18px;
            cursor: default;
        }

        .window-body {
            padding: 10px;
        }

        /* Campos de Info (Fecha y Usuario) */
        .info-fields {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            padding: 5px;
        }

        /* Grupo de filtros / Fieldset general */
        .filter-fieldset {
            border: 1px solid #ACA899;
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .filter-group label {
            font-size: 11px;
            white-space: nowrap;
        }
        /* Inputs y Selects */
        .input-text, .input-select {
            font-size: 11px;
            padding: 2px;
            border: 1px solid #7F9DB9;
            background-color: #FFFFFF;
        }
        .input-text {
            min-width: 80px;
        }
        /* Botón clásico */
        .btn-classic {
            font-size: 11px;
            background-color: #ECE9D8;
            border: 1px solid #666;
            box-shadow: 1px 1px 1px #FFF;
            padding: 3px 12px;
            cursor: pointer;
            outline: none;
        }
        .btn-classic:hover {
            border: 1px solid #000;
        }
        .btn-classic:active {
            box-shadow: inset 1px 1px 1px #888;
            background-color: #D6D6C8;
        }

        /* Contenedor de la tabla con scroll */
        .table-container {
            border: 1px solid #7F9DB9;
            max-height: 300px; /* Altura para forzar el scroll */
            overflow-y: scroll;
            background-color: #FFFFFF;
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #DDD;
            padding: 4px 6px;
            white-space: nowrap;
            text-align: left;
        }
        th {
            background-color: #D6D6C8; /* Cabecera de tabla más gris */
            font-weight: bold;
            position: sticky;
            top: 0;
            border-bottom: 1px solid #ACA899;
            z-index: 10;
        }
        td.col-visualizar a {
            color: blue;
            text-decoration: underline;
            cursor: pointer;
        }
        td.col-seleccion, th.col-seleccion {
            text-align: center;
            width: 50px;
        }

        /* Barra de pie de página */
        .footer-bar {
            border-top: 1px solid #ACA899;
            padding-top: 10px;
            display: flex;
            justify-content: flex-end;
            gap: 6px;
        }
        
        /* Estilos específicos para el Editor de Preguntas (Wireframe) */
        .question-editor-container {
            border: 1px solid #ACA899; 
            padding: 10px; 
            margin-top: 15px;
            background-color: #F0F0E8; /* Ligero cambio de color para el área de edición */
        }
        .question-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }
        .question-row-header {
             margin-top: 10px;
             padding-bottom: 5px;
             border-bottom: 1px solid #C0C0C0;
             font-weight: bold;
        }
        .field-label {
            width: 80px; /* Ancho fijo para etiquetas de campo */
            text-align: right;
        }

    </style>
</head>
<body class="bg-violet-100 font-sans" 
    style="background-image: url('https://www.shutterstock.com/image-illustration/ai-brain-artificial-intelligence-neural-600nw-2614012815.jpg'); 
            background-size: cover; 
            background-position: center; 
            background-attachment: fixed;">

    
<!-- VISTA DE INICIO (Simple) -->
    <div id="inicio-view" class="view active">
        <div class="min-h-screen flex flex-col items-center justify-center text-center p-8">
            <div class="bg-gray-900/80 backdrop-blur-sm rounded-xl shadow-2xl p-10 max-w-xl w-full border border-violet-700">
                
                <!-- Logo - Usamos un placeholder seguro ya que la ruta local no es válida -->
                <img src="C:\Users\Thiago Alejo Decalli\Pictures\quizmind.PNG" alt="Logo QuizzMind" 
                     class="h-32 w-32 rounded-full shadow-xl mb-6 mx-auto border-4 border-violet-400">
                
                <h1 class="text-5xl font-extrabold text-white mb-4 tracking-wider">QuizMind</h1>
                <p class="text-lg text-violet-200 mb-10 max-w-md mx-auto">
                    Un Cambio en el estudio haciéndolo un poco más autodidacta y mejorando la medida de 
                    efectividad que tiene nuestro aprendizaje.
                </p>
                
                <button onclick="navigateTo('consultar')" 
                        class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 text-lg uppercase tracking-wider focus:outline-none focus:ring-4 focus:ring-violet-300">
                    Consultar Cuestionarios Incrementales
                </button>
            </div>
        </div>
    </div>

    <!-- VISTA DE CONSULTA -->
    <div id="consultar-view" class="view">
        
        <!-- Botón para volver al inicio -->
        <div class="text-center mt-4">
             <button onclick="navigateTo('inicio')" class="text-sm text-violet-600 hover:underline">&larr; Volver al Inicio</button>
        </div>
        
        <!-- Contenedor de la Ventana -->
        <div id="consultar-view-container">
            <!-- Barra de Título -->
            <div class="window-title-bar">
                <h1>Consultar cuestionarios incrementales</h1>
                <div class="window-controls">
                    <span>_</span><span>&#9633;</span><span>X</span>
                </div>
            </div>

            <!-- Cuerpo de la Ventana -->
            <div class="window-body">
                
                <!-- CAMPOS DE INFO (Fecha y Usuario) -->
                <div class="info-fields">
                    <div class="filter-group">
                        <label for="f-fecha">Fecha:</label>
                        <input type="text" id="f-fecha" class="input-text" value="dd/mm/aaaa" style="width: 70px;">
                    </div>
                    <div class="filter-group">
                        <label for="f-usuario">Usuario:</label>
                        <input type="text" id="f-usuario" class="input-text" value="UsuarioActual" readonly>
                    </div>
                </div>

                <!-- Filtros -->
                <fieldset class="filter-fieldset">
                    <div class="filter-group">
                        <label for="f-materia">Materia:</label>
                        <select id="f-materia" class="input-select" style="width: 100px;">
                            <option value="">(Todas)</option>
                            <option value="matematicas">Matemáticas</option>
                            <option value="historia">Historia</option>
                            <option value="literatura">Literatura</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="f-unidad">Unidad:</label>
                        <select id="f-unidad" class="input-select" style="width: 70px;">
                            <option value="">(Todas)</option>
                            <option value="U-01">U-01</option>
                            <option value="U-02">U-02</option>
                            <option value="U-03">U-03</option>
                            <option value="U-04">U-04</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="f-tipo">Tipo incremento:</label>
                        <select id="f-tipo" class="input-select" style="width: 100px;">
                            <option>(Todos)</option>
                            <option>Formativo</option>
                            <option>Final</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="f-ordenar">Ordenar:</label>
                        <select id="f-ordenar" class="input-select" style="width: 100px;">
                            <option>Fecha (Desc.)</option>
                            <option>Número (Asc.)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="btn-classic" style="margin-left: 10px;">Buscar</button>
                    </div>
                </fieldset>

                <!-- Tabla -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Unidad</th>
                                <th>Tipo Incremento</th>
                                <th>Estado</th>
                                <th>Fecha Creación</th>
                                <th>Cantidad Preguntas</th>
                                <th>Visualizar</th>
                                <th class="col-seleccion">Selección</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>1001</td> <td>U-01</td> <td>Formativo</td> <td>Sin completar</td> <td>10/11/2025</td> <td>10</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1002</td> <td>U-02</td> <td>Formativo</td> <td>Completado</td> <td>11/11/2025</td> <td>5</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1003</td> <td>U-01</td> <td>Formativo</td> <td>Sin completar</td> <td>12/11/2025</td> <td>8</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1004</td> <td>U-03</td> <td>Formativo</td> <td>Sin completar</td> <td>12/11/2025</td> <td>10</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1005</td> <td>U-02</td> <td>Formativo</td> <td>Sin completar</td> <td>13/11/2025</td> <td>6</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1006</td> <td>U-04</td> <td>Formativo</td> <td>Completado</td> <td>13/11/2025</td> <td>12</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1007</td> <td>U-01</td> <td>Formativo</td> <td>Sin completar</td> <td>14/11/2025</td> <td>15</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1008</td> <td>U-03</td> <td>Formativo</td> <td>Completado</td> <td>15/11/2025</td> <td>7</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1009</td> <td>U-04</td> <td>Formativo</td> <td>Sin completar</td> <td>16/11/2025</td> <td>10</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1010</td> <td>U-01</td> <td>Formativo</td> <td>Sin completar</td> <td>17/11/2025</td> <td>9</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1011</td> <td>U-02</td> <td>Formativo</td> <td>Sin completar</td> <td>18/11/2025</td> <td>11</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1012</td> <td>U-03</td> <td>Formativo</td> <td>Completado</td> <td>19/11/2025</td> <td>5</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                        </tbody>
                    </table>
                </div>

               <!-- Barra de Total y Botón Habilitación -->
                <div class="total-bar flex justify-between items-center mb-4">
                    <div class="filter-group">
                        <label for="f-total">Total de incrementos seleccionados:</label>
                        <input type="text" id="f-total" class="input-text input-readonly" value="0" readonly style="width: 40px;">
                    </div>
                    <button class="btn-classic" onclick="handleHabilitacionClick()">Registrar habilitacion de cuestionario incremental</button>
                </div>

                <!-- Barra de Pie de página -->
                <div class="footer-bar">
                    <button class="btn-classic" onclick="navigateTo('inicio')">Salir</button>
                    <!-- MODIFICADO: Navega a la nueva vista de registro -->
                    <button class="btn-classic" style="font-weight: bold;" onclick="navigateTo('registro')">Registrar nuevo cuestionario incremental</button>
		    
                </div>

            </div>
        </div>
    </div>	
    
    <!-- VISTA DE REGISTRO DE HABILITACIÓN -->
    <div id="habilitacion-view" class="view">
        
        <!-- Botón para volver al consulta -->
        <div class="text-center mt-4">
               <button onclick="navigateTo('consultar')" class="text-sm text-violet-600 hover:underline">&larr; Volver a Consulta</button>
        </div>

        <!-- Contenedor de la Ventana -->
        <div id="habilitacion-view-container">
            <!-- Barra de Título -->
            <div class="window-title-bar">
                <h1>Registrar habilitación de cuestionario incremental</h1>
                <div class="window-controls">
                    <span role="button" aria-label="Minimizar">0</span> 
                    <span role="button" aria-label="Maximizar">1</span>
                    <span role="button" aria-label="Cerrar">r</span>
                </div>
            </div>

            <!-- Cuerpo de la Ventana -->
            <div class="window-body">
                
                <!-- Campos de cabecera del cuestionario seleccionado -->
                <fieldset class="filter-fieldset justify-start">
                    <legend class="mx-2 px-1 text-xs font-bold text-gray-700">Cuestionario seleccionado</legend>
                    <div class="filter-group">
                        <label for="h-cuestionario">Cuestionario:</label>
                        <input type="text" id="h-cuestionario" class="input-text input-readonly" value="1005" readonly style="width: 60px;">
                    </div>
                    <div class="filter-group">
                        <label for="h-materia">Materia:</label>
                        <input type="text" id="h-materia" class="input-text input-readonly" value="Historia" readonly style="width: 120px;">
                    </div>
                    <div class="filter-group">
                        <label for="h-unidad">Unidad:</label>
                        <input type="text" id="h-unidad" class="input-text input-readonly" value="U-02" readonly style="width: 50px;">
                    </div>
                </fieldset>

                <!-- Área de Descripción, Habilitación, Contraseña y Caducidad -->
                <div class="flex gap-4 mb-4">
                    <!-- Grupo: Descripción y Contraseña (se combinan) -->
                    <div class="editor-group flex-1 flex flex-col">
                        <legend class="mx-2 px-1 text-xs font-bold text-gray-700">Configuración General</legend>
                        <!-- DESCRIPCIÓN -->
                        <div class="editor-row items-start">
                            <label class="field-label" for="h-descripcion">Descripción:</label>
                            <textarea id="h-descripcion" class="input-text flex-1" rows="3" placeholder="Detalles o motivo de la habilitación..."></textarea>
                        </div>
                        <!-- CONTRASEÑA -->
                        <div class="editor-row mt-2">
                            <label class="field-label flex items-center justify-end" for="h-requiere-pass">Requiere Contraseña:</label>
                            <!-- El checkbox va al lado de la etiqueta -->
                            <input type="checkbox" id="h-requiere-pass" class="flex-shrink-0" onchange="togglePasswordInput()">
                            
                            <!-- Contenedor del campo de contraseña (inicialmente oculto) -->
                            <div id="password-group" class="filter-group ml-4" style="display: none;">
                                <label for="h-password">Contraseña:</label>
                                <input type="password" id="h-password" class="input-text" style="width: 100px;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Grupo: Habilitación y Caducidad (se mantienen) -->
                    <div class="flex flex-col gap-4 w-1/2">
                        <!-- Grupo: Habilitación -->
                        <fieldset class="editor-group flex-1">
                            <legend class="mx-2 px-1 text-xs font-bold text-gray-700">Detalles de Habilitación</legend>
                            <div class="editor-row">
                                <label class="field-label" for="h-usuario-hab">Usuario que habilita:</label>
                                <!-- ID actualizado a h-usuario-hab para evitar confusión -->
                                <input type="text" id="h-usuario-hab" class="input-text input-readonly flex-1" value="AdminSystem" readonly>
                            </div>
                            <div class="editor-row">
                                <label class="field-label" for="h-fecha-hab">Fecha de Habilitación:</label>
                                <input type="date" id="h-fecha-hab" class="input-text flex-1">
                            </div>
                            <div class="editor-row">
                                <label class="field-label" for="h-hora-hab">Horario Habilitación:</label>
                                <input type="time" id="h-hora-hab" class="input-text flex-1" value="09:00">
                            </div>
                        </fieldset>

                        <!-- Grupo: Caducidad -->
                        <fieldset class="editor-group flex-1">
                            <legend class="mx-2 px-1 text-xs font-bold text-gray-700">Período de validez</legend>
                            <div class="editor-row">
                                <label class="field-label" for="h-fecha-cad">Fecha de caducidad:</label>
                                <input type="date" id="h-fecha-cad" class="input-text flex-1">
                            </div>
                            <div class="editor-row">
                                <label class="field-label" for="h-hora-cad">Horario de caducidad:</label>
                                <input type="time" id="h-hora-cad" class="input-text flex-1" value="23:59">
                            </div>
                        </fieldset>
                    </div>
                </div>

                <!-- Detalles de Preguntas (Tabla) -->
                <div class="editor-group">
                    <legend class="mx-2 px-1 text-xs font-bold text-gray-700">Preguntas del cuestionario</legend>
                    <div class="table-container" style="max-height: 200px;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ítem</th>
                                    <th>Pregunta</th>
                                    <th>Respuesta</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Datos de ejemplo para la tabla de preguntas. Usamos data-item-id para simular datos reales -->
                                <tr data-item-id="P1"><td>1</td> <td>¿Qué es el Big Bang?</td> <td>Expansión inicial del universo.</td> <td>Activa</td></tr>
                                <tr data-item-id="P2"><td>2</td> <td>Capital de Chile.</td> <td>Santiago.</td> <td>Activa</td></tr>
                                <tr data-item-id="P3"><td>3</td> <td>Fórmula del agua.</td> <td>H₂O</td> <td>Activa</td></tr>
                                <tr data-item-id="P4"><td>4</td> <td>¿Quién escribió El Quijote?</td> <td>Miguel de Cervantes</td> <td>Activa</td></tr>
                                <tr data-item-id="P5"><td>5</td> <td>¿Cuántos huesos tiene el cuerpo humano adulto?</td> <td>206</td> <td>Activa</td></tr>
                                <tr data-item-id="P6"><td>6</td> <td>¿Qué es la fotosíntesis?</td> <td>Proceso vegetal...</td> <td>Activa</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>


                <!-- Barra de Pie de página -->
                <div class="footer-bar" style="border-top: none;">
                    <button class="btn-classic" onclick="navigateTo('consultar')">Cancelar</button>
                    <!-- El botón de grabar no debe tener un background-color directo en el HTML, sino usar la clase -->
                    <button class="btn-classic" style="font-weight: bold;" onclick="showModal('¡Habilitación grabada exitosamente!', 'Confirmación')">Registrar confirmacion de habilitación de cuestionario incremental</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL DE MENSAJE PERSONALIZADO (Reemplazo de alert()) -->
    <div id="custom-modal" class="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <!-- ID y Título del Modal actualizados por JS -->
            <div id="modal-title-bar" class="modal-title-bar">Advertencia</div>
            <div class="modal-body">
                <div class="flex items-center">
                     <!-- Icono de Advertencia -->
                    <span id="modal-icon" class="modal-icon">&#9888;</span> 
                    <p id="modal-message">Mensaje de error.</p>
                </div>
                <button class="btn-classic" onclick="closeModal()" style="min-width: 80px;">Aceptar</button>
            </div>
        </div>
    </div>

    <script>
        // --- FUNCIONES DE JAVASCRIPT ---

        // 1. Inicialización de la vista
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar fecha actual en la vista de consulta
            const fechaInput = document.getElementById('f-fecha-value');
            if (fechaInput) {
                const now = new Date();
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = now.getFullYear();
                fechaInput.value = `${day}/${month}/${year}`;
            }

            // Inicializar fecha de habilitación y caducidad con valores por defecto
            const fechaHoy = new Date().toISOString().split('T')[0];
            const fechaCaducidad = new Date(new Date().getTime() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            const hFechaHab = document.getElementById('h-fecha-hab');
            if (hFechaHab) hFechaHab.value = fechaHoy;

            const hFechaCad = document.getElementById('h-fecha-cad');
            if (hFechaCad) hFechaCad.value = fechaCaducidad;

            // Añadir listener para actualizar el total de seleccionados al cargar la página
            updateTotalSelected();
            
            // Añadir listeners a todos los checkboxes de selección
            document.querySelectorAll('.select-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateTotalSelected);
            });
        });

        // 2. Control de Vistas (Navegación)
        function navigateTo(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            const nextView = document.getElementById(viewId + '-view');
            if (nextView) {
                nextView.classList.add('active');
            }
        }
        
        // 3. Control del Modal Personalizado (Reemplazo de alert())
        function showModal(message, title = 'Advertencia', icon = '&#9888;') {
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-message').innerHTML = message;
            document.getElementById('modal-title-bar').textContent = title;
            document.getElementById('modal-icon').innerHTML = icon;
            
            // Ajustar color del icono según el título/tipo
            const modalIconElement = document.getElementById('modal-icon');
            if (title === 'Error') {
                modalIconElement.style.color = '#FF0000'; // Rojo
            } else if (title === 'Confirmación') {
                 modalIconElement.style.color = '#008000'; // Verde
            } else {
                 modalIconElement.style.color = '#FFCC00'; // Amarillo por defecto
            }

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('custom-modal').style.display = 'none';
        }

        // 4. Lógica de selección de cuestionarios
        function updateTotalSelected() {
            const checkboxes = document.querySelectorAll('.select-checkbox');
            let selectedCount = 0;
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedCount++;
                }
            });
            document.getElementById('f-total').value = selectedCount;
            return selectedCount;
        }

        // 5. Lógica del botón de Habilitación
        function handleHabilitacionClick() {
            const selectedCount = updateTotalSelected();
            const selectedCheckboxes = Array.from(document.querySelectorAll('.select-checkbox:checked'));

            if (selectedCount === 0) {
                showModal('Debe seleccionar al menos un cuestionario para realizar la habilitación.', 'Advertencia', '&#9888;');
                return;
            }
            
            if (selectedCount > 1) {
                 showModal('Solo puede seleccionar un (1) cuestionario a la vez para su habilitación. Por favor, desmarque las selecciones sobrantes.', 'Advertencia', '&#9888;');
                return;
            }

            // Si solo se selecciona uno:
            const selectedRow = selectedCheckboxes[0].closest('tr');
            const estado = selectedRow.getAttribute('data-estado');
            const numero = selectedRow.cells[0].textContent;
            const unidad = selectedRow.cells[1].textContent;
            
            if (estado === 'Completado') {
                showModal(`El cuestionario N° ${numero} ya se encuentra en estado "Completado" y no puede ser habilitado nuevamente.`, 'Error', '&#128711;'); // Icono de error
                return;
            }
            
            // Si pasa todas las validaciones, navega y carga los datos
            loadHabilitacionData(numero, unidad, 'Materia Ejemplo'); // Se asume una materia
            navigateTo('habilitacion');
        }

        // 6. Carga de datos en la Vista de Habilitación (Simulación)
        function loadHabilitacionData(numero, unidad, materia) {
            document.getElementById('h-cuestionario').value = numero;
            document.getElementById('h-materia').value = materia;
            document.getElementById('h-unidad').value = unidad;
            // Aquí se cargaría la tabla de preguntas reales desde una fuente de datos
        }

        // 7. Toggle Contraseña
        function togglePasswordInput() {
            const checkbox = document.getElementById('h-requiere-pass');
            const passwordGroup = document.getElementById('password-group');
            if (checkbox.checked) {
                passwordGroup.style.display = 'flex';
            } else {
                passwordGroup.style.display = 'none';
            }
        }
    </script>
   
    <!-- VISTA DE REGISTRO (Registro nuevo cuestionario incremental) -->
    <div id="registro-view" class="view">
        
        <!-- Botón para volver al inicio -->
        <div class="text-center mt-4">
             <button onclick="navigateTo('inicio')" class="text-sm text-violet-600 hover:underline">&larr; Volver al Inicio</button>
        </div>
        
        <div id="registro-view-container">
            <!-- Barra de Título -->
            <div class="window-title-bar">
                <h1>Registrar nuevo cuestionario incremental</h1>
                <div class="window-controls">
                    <span>_</span><span>&#9633;</span><span>X</span>
                </div>
            </div>

            <!-- Cuerpo de la Ventana -->
            <div class="window-body">
                
                <!-- CAMPOS DE INFO (Fecha y Usuario) -->
                <div class="info-fields">
                    <div class="filter-group">
                        <label for="r-fecha">Fecha:</label>
                        <input type="text" id="r-fecha" class="input-text" value="dd/mm/aaaa" style="width: 70px;">
                    </div>
                    <div class="filter-group">
                        <label for="r-usuario">Usuario:</label>
                        <input type="text" id="r-usuario" class="input-text" value="UsuarioActual" readonly>
                    </div>
                </div>

                <!-- FORMULARIO PRINCIPAL Y DINÁMICO -->
                <div class="flex flex-col gap-4">
                    
                    <!-- Fila 1: Título e Tipo Incremento -->
                    <div class="flex gap-4">
                         <div class="filter-group flex-1">
                            <label for="r-titulo-incremento">Título Incremento:</label>
                            <input type="text" id="r-titulo-incremento" class="input-text flex-1">
                        </div>
                        <div class="filter-group">
                            <label for="r-tipo-incremento">Tipo Incremento:</label>
                            <select id="r-tipo-incremento" class="input-select" onchange="toggleIncrementType(this.value)">
                                <option value="Formativo">Formativo</option>
                                <option value="Final">Final</option>
                            </select>
                        </div>
                    </div>


                    <!-- CONTENIDO DINÁMICO (Banco de preguntas o Cuestionarios Completados) -->
                    <div id="dynamic-content">
                        <!-- Contenido por defecto (Formativo) -->
                        <div id="formativo-section" class="filter-fieldset" style="display: block; gap: 0;">
                            <div class="font-bold mb-2">Banco de preguntas</div>
                            <!-- Filtros del Banco -->
                            <div class="flex gap-4 mb-3 items-center">
                                <div class="filter-group">
                                    <label for="r-unidad">Unidad:</label>
                                    <select id="r-unidad" class="input-select" style="width: 70px;">
                                        <option value="">(Todas)</option>
                                        <option>U-01</option><option>U-02</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="r-estado">Estado:</label>
                                    <select id="r-estado" class="input-select" style="width: 90px;">
                                        <option value="">(Todos)</option>
                                        <option>Activo</option><option>Inactivo</option>
                                    </select>
                                </div>
                                <button class="btn-classic">Buscar</button>
                            </div>
                            
                            <!-- Tabla de preguntas del Banco -->
                            <div class="table-container" style="max-height: 150px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Número</th>
                                            <th>Pregunta</th>
                                            <th>Estado</th>
                                            <th class="col-seleccion">Seleccionar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bank-questions-body">
                                        <!-- Preguntas de ejemplo Formativo -->
                                        <tr><td>1</td> <td>¿Qué es la dilatación térmica?</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>2</td> <td>Defina el Teorema de Pitágoras.</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>3</td> <td>Leyes de Newton.</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>4</td> <td>¿Qué fue la Revolución Francesa?</td> <td>Inactivo</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>5</td> <td>Capital de Argentina.</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions()"></td></tr>
                                    </tbody>
                                </table>
                            </div>
                            
                        </div>
                        
                        <!-- Contenido para Final (Oculto por defecto) -->
                        <div id="final-section" class="filter-fieldset" style="display: none; flex-direction: column; gap: 0;">
                            <div class="font-bold mb-2">Cuestionarios Completados (Fuente de preguntas con mayor error)</div>
                            
                            <!-- Tabla de Cuestionarios Completados -->
                            <div class="table-container" style="max-height: 150px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Número Cuest.</th>
                                            <th>Unidad</th>
                                            <th>Fecha Completado</th>
                                            <th>Tasa de Error Prom.</th>
                                            <th class="col-seleccion">Seleccionar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="completed-quizzes-body">
                                        <!-- Cuestionarios de ejemplo Final -->
                                        <tr><td>1002</td> <td>U-02</td> <td>11/11/2025</td> <td>65%</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions(true)"></td></tr>
                                        <tr><td>1008</td> <td>U-03</td> <td>15/11/2025</td> <td>80%</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions(true)"></td></tr>
                                        <tr><td>1012</td> <td>U-03</td> <td>19/11/2025</td> <td>45%</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions(true)"></td></tr>
                                    </tbody>
                                </table>
                            </div>
                             <div class="text-xs text-gray-600 mt-1">
                                Nota: Al crear, se seleccionarán automáticamente las preguntas con la mayor tasa de error de los cuestionarios marcados.
                            </div>
                        </div>
                    </div>


                    <!-- Fila 2: Totales, Calificación y Opciones de Preguntas -->
                    <div class="flex flex-col gap-2 p-2" style="border: 1px dashed #C0C0C0;">
                        <div class="flex gap-10 items-center">
                            <div class="filter-group">
                                <label for="r-total-preguntas">Total preguntas seleccionadas:</label>
                                <input type="text" id="r-total-preguntas" class="input-text" value="0" readonly style="width: 40px; background-color: #F0F0F0;">
                            </div>
                        </div>
                        
                        <div class="flex gap-4 items-center">
                            <div class="filter-group">
                                <label for="r-calif-total">Calificación Total:</label>
                                <input type="text" id="r-calif-total" class="input-text" value="" style="width: 60px;">
                            </div>
                             <div class="filter-group">
                                <label for="r-tipo-puntaje">Tipo Puntaje:</label>
                                <select id="r-tipo-puntaje" class="input-select" style="width: 90px;">
                                    <option>Porcentaje</option>
                                    <option>Puntos</option>
                                </select>
                            </div>
                            <div class="filter-group ml-8">
                                <label>Ordenar preguntas al azar:</label>
                                <input type="radio" name="order-type" checked>
                            </div>
                            <div class="filter-group">
                                <label>Barajar respuestas:</label>
                                <input type="radio" name="order-type">
                            </div>
                        </div>

                        <div class="flex justify-center mt-3">
                            <button id="btnCrear" class="btn-classic" style="font-weight: bold; background-color: #D6D6A8;" onclick="toggleQuestionEditor()">Crear</button>
                        </div>
                    </div>


                    <!-- ÁREA DE EDICIÓN DE PREGUNTAS (Visible solo tras "Crear") -->
                    <div id="question-editor" class="question-editor-container" style="display:none; max-height: 400px; overflow-y: auto;">
                        <div class="font-bold text-base mb-2">Detalle de Preguntas Generadas:</div>
                        
                        <!-- PREGUNTA 2 (Simulada para el modo Formativo) -->
                        <div class="question-item border p-2 mb-3 bg-white">
                             <div class="question-row-header">
                                 <div class="flex gap-2">
                                     <label for="p9-num" style="width: 100px;">Número Pregunta:</label>
                                     <input type="text" id="p1-num" class="input-text" value="1" style="width: 30px;" readonly>
                                     
                                     <label for="p1-obligatorio">Obligatorio:</label>
                                     <input type="checkbox" id="p1-obligatorio" checked>
                                     
                                     <label for="p1-puntaje" style="margin-left: 20px;">Puntaje:</label>
                                     <input type="text" id="p1-puntaje" class="input-text" style="width: 40px;">
                                 </div>
                             </div>
                            <div class="question-row mt-2">
                                <label for="p1-nombre" style="width: 150px;">Nombre Pregunta:</label>
                                <input type="text" id="p1-nombre" class="input-text flex-1" value="¿Qué es la dilatación térmica?">
                                <button class="btn-classic">Registrar Imagen</button>
                            </div>

                            <!-- RESPUESTAS (Aquí el profesor ingresa los datos) -->
                            <div class="mt-2 ml-4 p-2 border-l border-dashed border-gray-400">
                                <div class="question-row">
                                    <label class="field-label">1. Respuesta:</label>
                                    <input type="text" class="input-text flex-1" value="">
                                    <label>Porcentaje:</label>
                                    <input type="text" class="input-text" style="width: 40px;">%
                                    <label>Retro:</label>
                                    <input type="text" class="input-text flex-1">
                                    <input type="checkbox" checked>
                                </div>
                                <div class="question-row">
                                    <label class="field-label">2. Respuesta:</label>
                                    <input type="text" class="input-text flex-1" value="">
                                    <label>Porcentaje:</label>
                                    <input type="text" class="input-text" style="width: 40px;">%
                                    <label>Retro:</label>
                                    <input type="text" class="input-text flex-1">
                                    <input type="checkbox">
                                </div>
                                <div class="question-row">
                                    <label class="field-label">n. Respuesta:</label>
                                    <input type="text" class="input-text flex-1" value="">
                                    <label>Porcentaje:</label>
                                    <input type="text" class="input-text" style="width: 40px;">%
                                    <label>Retro:</label>
                                    <input type="text" class="input-text flex-1">
                                    <input type="checkbox">
                                </div>
                            </div>
                        </div>
		
                
			<!-- PREGUNTA n (Simulada para el modo Formativo) -->
                        <div class="question-item border p-2 mb-3 bg-white">
                             <div class="question-row-header">
                                 <div class="flex gap-2">
                                     <label for="p1-num" style="width: 100px;">Número Pregunta:</label>
                                     <input type="text" id="p2-num" class="input-text" value="n" style="width: 30px;" readonly>
                                     
                                     <label for="p1-obligatorio">Obligatorio:</label>
                                     <input type="checkbox" id="p1-obligatorio" checked>
                                     
                                     <label for="p1-puntaje" style="margin-left: 20px;">Puntaje:</label>
                                     <input type="text" id="p1-puntaje" class="input-text" style="width: 40px;">
                                 </div>
                             </div>
                            <div class="question-row mt-2">
                                <label for="p1-nombre" style="width: 150px;">Nombre Pregunta:</label>
                                <input type="text" id="p1-nombre" class="input-text flex-1" value="Defina el Teorema de Pitágoras.">
                                <button class="btn-classic">Registrar Imagen</button>
                            </div>

                            <!-- RESPUESTAS (Aquí el profesor ingresa los datos) -->
                            <div class="mt-2 ml-4 p-2 border-l border-dashed border-gray-400">
                                <div class="question-row">
                                    <label class="field-label">1. Respuesta:</label>
                                    <input type="text" class="input-text flex-1" value="">
                                    <label>Porcentaje:</label>
                                    <input type="text" class="input-text" style="width: 40px;">%
                                    <label>Retro:</label>
                                    <input type="text" class="input-text flex-1">
                                    <input type="checkbox" checked>
                                </div>
                                <div class="question-row">
                                    <label class="field-label">2. Respuesta:</label>
                                    <input type="text" class="input-text flex-1" value="">
                                    <label>Porcentaje:</label>
                                    <input type="text" class="input-text" style="width: 40px;">%
                                    <label>Retro:</label>
                                    <input type="text" class="input-text flex-1">
                                    <input type="checkbox">
                                </div>
                                <div class="question-row">
                                    <label class="field-label">n. Respuesta:</label>
                                    <input type="text" class="input-text flex-1" value="">
                                    <label>Porcentaje:</label>
                                    <input type="text" class="input-text" style="width: 40px;">%
                                    <label>Retro:</label>
                                    <input type="text" class="input-text flex-1">
                                    <input type="checkbox">
                                </div>
                            </div>
                        </div>

                        <!-- Botones de Acción -->
                        <div class="flex justify-end gap-2 mt-4">
                            <button class="btn-classic" onclick="toggleQuestionEditor(true)">Cancelar</button>
                            <button class="btn-classic" style="font-weight: bold; background-color: #B2D8B2;">Confirmar</button>
                        </div>
                    </div>


                </div>
                
                <!-- Barra de Pie de página -->
                <div class="footer-bar mt-4">
                    <button class="btn-classic" onclick="navigateTo('inicio')">Salir</button>
                    <button class="btn-classic" style="font-weight: bold;">confirmar registracion nuevo cuestionario incremental</button>
                </div>

            </div>
        </div>
    </div>
   
     
    <!-- JavaScript para Lógica de Vistas y Dinámicas -->
    <script>
        // Inicializa el total de seleccionados en la vista de consulta
        document.addEventListener('DOMContentLoaded', () => {
             updateTotalSelected();
             // Asignar fecha actual al campo de registro (simulado)
             const dateField = document.getElementById('r-fecha');
             if (dateField) {
                 const today = new Date();
                 const d = String(today.getDate()).padStart(2, '0');
                 const m = String(today.getMonth() + 1).padStart(2, '0');
                 const y = today.getFullYear();
                 dateField.value = `${d}/${m}/${y}`;
             }
        });

        // 1. Lógica de Navegación de Vistas
        function navigateTo(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            const targetView = document.getElementById(viewId + '-view');
            if (targetView) {
                targetView.classList.add('active');
            }
        }
        
        // 2. Lógica para actualizar el contador de seleccionados en la vista de CONSULTAR
        function updateTotalSelected() {
            const checkboxes = document.querySelectorAll('#consultar-view-container input[type="checkbox"]');
            let count = 0;
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    count++;
                }
            });
            const totalInput = document.getElementById('f-total');
            if (totalInput) {
                totalInput.value = count;
            }
        }

        // 3. Lógica dinámica para la vista de REGISTRO (Formativo vs. Final)
        function toggleIncrementType(type) {
            const formativoSection = document.getElementById('formativo-section');
            const finalSection = document.getElementById('final-section');
            const editor = document.getElementById('question-editor');

            editor.style.display = 'none'; // Ocultar editor al cambiar de tipo

            if (type === 'Final') {
                formativoSection.style.display = 'none';
                finalSection.style.display = 'flex';
            } else { // Formativo
                formativoSection.style.display = 'block';
                finalSection.style.display = 'none';
            }
            // Recalcular total de preguntas seleccionadas
            updateTotalQuestions();
        }

        // 4. Lógica para actualizar el contador de preguntas en la vista de REGISTRO
        function updateTotalQuestions(isFinal = false) {
            let selector = '#formativo-section input[type="checkbox"]';
            if (document.getElementById('r-tipo-incremento').value === 'Final' || isFinal) {
                // En modo Final, contamos los cuestionarios seleccionados como "preguntas" fuente
                selector = '#final-section input[type="checkbox"]';
            }
            
            const checkboxes = document.querySelectorAll(selector);
            let count = 0;
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    count++;
                }
            });

            const totalInput = document.getElementById('r-total-preguntas');
            if (totalInput) {
                // Para el modo formativo, el total es el número de preguntas a crear.
                // Para el modo final, el total es el número de cuestionarios fuente.
                totalInput.value = count;
            }
        }
        
        // 5. Lógica para mostrar/ocultar el Editor de Preguntas
        function toggleQuestionEditor(cancel = false) {
            const editor = document.getElementById('question-editor');
            
            if (editor.style.display === 'none' && !cancel) {
                // Lógica de CREAR (simulada): Muestra el editor
                // Nota: Aquí iría la lógica backend para:
                // 1.  Si es Final: Generar preguntas con mayor error y cargarlas en el editor.
                // 2.  Si es Formativo: Tomar las preguntas del banco y cargarlas en el editor para que el profe ponga las respuestas/retro.
                editor.style.display = 'block';
                document.getElementById('btnCrear').textContent = 'Recargar Editor';
            } else if (editor.style.display === 'block' || cancel) {
                // Lógica de CANCELAR/OCULTAR
                 editor.style.display = 'none';
                 document.getElementById('btnCrear').textContent = 'Crear';
            }
        }
        
        // Inicializar la vista dinámica y el contador
        window.onload = function() {
            toggleIncrementType(document.getElementById('r-tipo-incremento').value);
            updateTotalSelected();
        };
    </script>

</body>
</html>
