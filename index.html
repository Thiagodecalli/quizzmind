<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototipo QuizMind v2</title>
    <!-- Incluyendo Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- ESTILOS COMPARTIDOS (Estilo Windows Clásico) --- */
        
        /* Ocultar vistas no activas */
        .view {
            display: none;
        }
        .view.active {
            display: block;
        }
        
        /* Contenedor de la ventana de aplicación */
        #consultar-view-container, #registro-view-container, #habilitacion-view-container {
            font-family: 'Tahoma', 'MS Sans Serif', Arial, sans-serif;
            font-size: 11px;
            background-color: #ECE9D8; /* Color de fondo de ventana clásico */
            border: 1px solid #000;
            width: 800px; 
            margin: 2rem auto;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.3);
            /* AÑADIDO: Posición relativa para el menú contextual */
            position: relative; 
        }

        /* Barra de título azul */
        .window-title-bar {
            background: linear-gradient(to right, #0058A8, #A6CAF0);
            padding: 4px 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #000;
        }
        .window-title-bar h1 {
            color: white;
            font-weight: bold;
            font-size: 12px;
            margin: 0;
        }
        /* Botones falsos de min/max/cerrar */
        .window-controls {
            display: flex;
            gap: 2px;
        }
        .window-controls span {
            width: 18px;
            height: 18px;
            background-color: #ECE9D8;
            border: 1px solid #666;
            cursor: default;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .window-controls span svg {
            width: 11px; 
            height: 11px;
            stroke: #333; 
        }


        .window-body {
            padding: 10px;
        }

        /* Campos de Info (Fecha y Usuario) */
        .info-fields {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            padding: 5px;
        }

        /* Grupo de filtros / Fieldset general */
        .filter-fieldset {
            border: 1px solid #ACA899;
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }
        .filter-fieldset legend {
            font-weight: bold;
            margin-left: 10px;
            padding: 0 4px;
            background-color: #ECE9D8; 
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .filter-group label {
            font-size: 11px;
            white-space: nowrap;
        }
        /* Inputs y Selects */
        .input-text, .input-select {
            font-size: 11px;
            padding: 2px;
            border: 1px solid #7F9DB9;
            background-color: #FFFFFF;
        }
        .input-text {
            min-width: 80px;
        }
        .input-readonly {
             background-color: #F0F0F0;
        }
        
        /* Botón clásico */
        .btn-classic {
            font-size: 11px;
            background-color: #ECE9D8;
            border: 1px solid #666;
            box-shadow: 1px 1px 1px #FFF;
            padding: 3px 12px;
            cursor: pointer;
            outline: none;
        }
        .btn-classic:hover {
            border: 1px solid #000;
        }
        .btn-classic:active {
            box-shadow: inset 1px 1px 1px #888;
            background-color: #D6D6C8;
        }

        /* Contenedor de la tabla con scroll */
        .table-container {
            border: 1px solid #7F9DB9;
            max-height: 300px; 
            overflow-y: scroll;
            background-color: #FFFFFF;
            margin-bottom: 10px;
            width: 100%; 
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #DDD;
            padding: 4px 6px;
            white-space: nowrap;
            text-align: left;
            /* AÑADIDO: para mostrar/ocultar columnas */
            transition: all 0.2s;
        }
        th {
            background-color: #D6D6C8; 
            font-weight: bold;
            position: sticky;
            top: 0;
            border-bottom: 1px solid #ACA899;
            z-index: 10;
        }
        /* --- AÑADIDO: Estilos de Ordenamiento (Click Izquierdo) --- */
        th.sortable {
            cursor: pointer;
            user-select: none;
        }
        th.sortable:hover {
            background-color: #C8C8B8;
        }
        /* Contenedor para el título y el ícono */
        .th-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 4px;
        }
        .sort-icon {
            width: 12px;
            height: 12px;
            opacity: 0.5;
        }
        th.sorted-asc .sort-icon.asc,
        th.sorted-desc .sort-icon.desc {
            opacity: 1;
        }
        
        td.col-visualizar a {
            color: blue;
            text-decoration: underline;
            cursor: pointer;
        }
        td.col-seleccion, th.col-seleccion {
            text-align: center;
            width: 50px;
        }

        /* Barra de pie de página */
        .footer-bar {
            border-top: 1px solid #ACA899;
            padding-top: 10px;
            display: flex;
            justify-content: flex-end;
            gap: 6px;
        }
        
        /* Estilos específicos para el Editor de Preguntas (Wireframe) */
        .question-editor-container {
            border: 1px solid #ACA899; 
            padding: 10px; 
            margin-top: 15px;
            background-color: #F0F0E8; 
        }
        .question-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }
        .question-row-header {
             margin-top: 10px;
             padding-bottom: 5px;
             border-bottom: 1px solid #C0C0C0;
             font-weight: bold;
        }
        .field-label {
            width: 80px; 
            text-align: right;
        }

        /* --- NUEVO: Estilos de Fondo Dinámico --- */
        @keyframes dynamicBackground {
            0% { background-position: 50% 50%; background-size: 100% 100%; }
            50% { background-position: 40% 60%; background-size: 110% 110%; }
            100% { background-position: 50% 50%; background-size: 100% 100%; }
        }
        .dynamic-bg {
            background-image: url('https://www.shutterstock.com/image-illustration/ai-brain-artificial-intelligence-neural-600nw-2614012815.jpg'); 
            background-size: 100% 100%; 
            background-position: center; 
            background-attachment: fixed;
            animation: dynamicBackground 40s ease-in-out infinite;
        }

        /* --- MODIFICADO: ESTILOS DE MODAL DE ERROR (MODERNO) --- */
        .modal-overlay {
            display: none; 
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(10, 0, 20, 0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }
        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        /* --- NUEVO: Animación de entrada (Fade-in) --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-card {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        /* --- AÑADIDO: Estilos del Menú Contextual (Click Derecho) --- */
        #column-context-menu {
            display: none;
            position: absolute;
            z-index: 1001; /* Encima del modal de error si es necesario */
            background-color: #F0F0F0;
            border: 1px solid #7F9DB9;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            font-family: 'Tahoma', sans-serif;
            font-size: 11px;
            padding: 4px 0;
        }
        #column-context-menu ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        #column-context-menu li {
            padding: 4px 10px 4px 25px; /* Espacio para el check */
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        #column-context-menu li:hover {
            background-color: #A6CAF0;
            color: #000;
        }
        #column-context-menu li.checked::before {
            content: '✓'; /* Checkmark */
            position: absolute;
            left: 8px;
            top: 4px;
            font-weight: bold;
        }


    </style>
</head>
<body class="bg-violet-100 font-sans dynamic-bg">

    
<!-- VISTA DE INICIO (Simple) -->
    <div id="inicio-view" class="view active">
        <div class="min-h-screen flex flex-col items-center justify-center text-center p-8">
            <div class="bg-gray-900/80 backdrop-blur-sm rounded-xl shadow-2xl p-10 max-w-xl w-full border border-violet-700 fade-in-card">
                
                <div class="h-32 w-32 rounded-full shadow-xl mb-6 mx-auto border-4 border-violet-400 bg-gray-900 overflow-hidden">
                    <img src="https://raw.githubusercontent.com/Thiagodecalli/quizzmind/main/imagenproyecto.png" alt="Logo QuizMind" class="w-full h-full object-cover">
                </div>
                
                <h1 class="text-5xl font-extrabold mb-4 tracking-wider bg-gradient-to-r from-violet-400 to-purple-300 text-transparent bg-clip-text">QuizzMind</h1>
                <p class="text-lg text-violet-200 mb-10 max-w-md mx-auto">
                    Un Cambio en el estudio haciéndolo un poco más autodidacta y mejorando la medida de 
                    efectividad que tiene nuestro aprendizaje.
                </p>
                
                <button onclick="navigateTo('consultar')" 
                        class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 text-lg uppercase tracking-wider focus:outline-none focus:ring-4 focus:ring-violet-300
                               inline-flex items-center justify-center"> 
                    <span class="inline-flex items-center">
                        Consultar Cuestionarios Incrementales
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 ml-3">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3" />
                        </svg>
                    </span>
                </button>

            </div>
        </div>
    </div>

    <!-- VISTA DE CONSULTA -->
    <div id="consultar-view" class="view">
        
        <div class="text-center mt-4">
             <button onclick="navigateTo('inicio')" class="text-sm text-violet-600 hover:underline">&larr; Volver al Inicio</button>
        </div>
        
        <div id="consultar-view-container">
            <div class="window-title-bar">
                <h1>Consultar cuestionarios incrementales</h1>
                <div class="window-controls">
                    <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15" /></svg></span>
                    <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 2.25h19.5v19.5H2.25V2.25z" /></svg></span>
                    <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg></span>
                </div>
            </div>

            <div class="window-body">
                
                <div class="info-fields">
                    <div class="filter-group">
                        <label for="f-fecha">Fecha:</label>
                        <input type="text" id="f-fecha" class="input-text input-readonly" value="dd/mm/aaaa" style="width: 70px;" readonly>
                    </div>
                    <div class="filter-group">
                        <label for="f-usuario">Usuario:</label>
                        <input type="text" id="f-usuario" class="input-text input-readonly" value="UsuarioActual" readonly>
                    </div>
                </div>

                <fieldset class="filter-fieldset">
                    <div class="filter-group">
                        <label for="f-materia">Materia:</label>
                        <select id="f-materia" class="input-select" style="width: 100px;">
                            <option value="">(Todas)</option>
                            <option value="matematicas">Matemáticas</option>
                            <option value="historia">Historia</option>
                            <option value="literatura">Literatura</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="f-unidad">Unidad:</label>
                        <select id="f-unidad" class="input-select" style="width: 70px;">
                            <option value="">(Todas)</option>
                            <option value="U-01">U-01</option>
                            <option value="U-02">U-02</option>
                            <option value="U-03">U-03</option>
                            <option value="U-04">U-04</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="f-tipo">Tipo incremento:</label>
                        <select id="f-tipo" class="input-select" style="width: 100px;">
                            <option>(Todos)</option>
                            <option>Formativo</option>
                            <option>Final</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="f-ordenar">Ordenar:</label>
                        <select id="f-ordenar" class="input-select" style="width: 100px;">
                            <option>Fecha (Desc.)</option>
                            <option>Número (Asc.)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="btn-classic" style="margin-left: 10px;">Buscar</button>
                    </div>
                </fieldset>

                <!-- 
                  MODIFICADO: Tabla de Consulta 
                  - Añadidos 'data-col' a th/td para vincularlos
                  - Añadidos 'th' con 'onclick' y 'oncontextmenu'
                  - Añadida estructura .th-content para íconos de orden
                -->
                <div class="table-container">
                    <table id="consultar-tabla">
                        <thead>
                            <tr>
                                <th class="sortable" data-col="numero" onclick="sortTable(this, 0)" oncontextmenu="showColumnMenu(event)">
                                    <div class="th-content">
                                        <span>Número</span>
                                        <span class="sort-icon-container">
                                            <svg class="sort-icon asc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" /></svg>
                                            <svg class="sort-icon desc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                                        </span>
                                    </div>
                                </th>
                                <th class="sortable" data-col="unidad" onclick="sortTable(this, 1)" oncontextmenu="showColumnMenu(event)">
                                    <div class="th-content">
                                        <span>Unidad</span>
                                        <span class="sort-icon-container">
                                            <svg class="sort-icon asc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" /></svg>
                                            <svg class="sort-icon desc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                                        </span>
                                    </div>
                                </th>
                                <th class="sortable" data-col="tipo" onclick="sortTable(this, 2)" oncontextmenu="showColumnMenu(event)">
                                    <div class="th-content">
                                        <span>Tipo Incremento</span>
                                        <span class="sort-icon-container">
                                            <svg class="sort-icon asc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" /></svg>
                                            <svg class="sort-icon desc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                                        </span>
                                    </div>
                                </th>
                                <th class="sortable" data-col="estado" onclick="sortTable(this, 3)" oncontextmenu="showColumnMenu(event)">
                                    <div class="th-content">
                                        <span>Estado</span>
                                        <span class="sort-icon-container">
                                            <svg class="sort-icon asc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" /></svg>
                                            <svg class="sort-icon desc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                                        </span>
                                    </div>
                                </th>
                                <th class="sortable" data-col="fecha" onclick="sortTable(this, 4)" oncontextmenu="showColumnMenu(event)">
                                    <div class="th-content">
                                        <span>Fecha Creación</span>
                                        <span class="sort-icon-container">
                                            <svg class="sort-icon asc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" /></svg>
                                            <svg class="sort-icon desc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                                        </span>
                                    </div>
                                </th>
                                <th class="sortable" data-col="cantidad" onclick="sortTable(this, 5)" oncontextmenu="showColumnMenu(event)">
                                    <div class="th-content">
                                        <span>Cantidad Preguntas</span>
                                        <span class="sort-icon-container">
                                            <svg class="sort-icon asc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" /></svg>
                                            <svg class="sort-icon desc" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                                        </span>
                                    </div>
                                </th>
                                <th data-col="visualizar" oncontextmenu="showColumnMenu(event)">Visualizar</th>
                                <th class="col-seleccion" data-col="seleccion" oncontextmenu="showColumnMenu(event)">Selección</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Datos de ejemplo con data-col -->
                            <tr><td data-col="numero">1001</td> <td data-col="unidad">U-01</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Sin completar</td> <td data-col="fecha">10/11/2025</td> <td data-col="cantidad">10</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1002</td> <td data-col="unidad">U-02</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Completado</td> <td data-col="fecha">11/11/2025</td> <td data-col="cantidad">5</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1003</td> <td data-col="unidad">U-01</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Sin completar</td> <td data-col="fecha">12/11/2025</td> <td data-col="cantidad">8</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1004</td> <td data-col="unidad">U-03</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Sin completar</td> <td data-col="fecha">12/11/2025</td> <td data-col="cantidad">10</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1005</td> <td data-col="unidad">U-02</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Sin completar</td> <td data-col="fecha">13/11/2025</td> <td data-col="cantidad">6</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1006</td> <td data-col="unidad">U-04</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Completado</td> <td data-col="fecha">13/11/2025</td> <td data-col="cantidad">12</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1007</td> <td data-col="unidad">U-01</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Sin completar</td> <td data-col="fecha">14/11/2025</td> <td data-col="cantidad">15</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1008</td> <td data-col="unidad">U-03</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Completado</td> <td data-col="fecha">15/11/2025</td> <td data-col="cantidad">7</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1009</td> <td data-col="unidad">U-04</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Sin completar</td> <td data-col="fecha">16/11/2025</td> <td data-col="cantidad">10</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1010</td> <td data-col="unidad">U-01</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Sin completar</td> <td data-col="fecha">17/11/2025</td> <td data-col="cantidad">9</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1011</td> <td data-col="unidad">U-02</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Sin completar</td> <td data-col="fecha">18/11/2025</td> <td data-col="cantidad">11</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td data-col="numero">1012</td> <td data-col="unidad">U-03</td> <td data-col="tipo">Formativo</td> <td data-col="estado">Completado</td> <td data-col="fecha">19/11/2025</td> <td data-col="cantidad">5</td> <td data-col="visualizar" class="col-visualizar"><a>Ver</a></td> <td data-col="seleccion" class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                        </tbody>
                    </table>
                </div>

               <div class="total-bar flex justify-between items-center mb-4">
                    <div class="filter-group">
                        <label for="f-total">Total de incrementos seleccionados:</label>
                        <input type="text" id="f-total" class="input-text input-readonly" value="0" readonly style="width: 40px;">
                    </div>
                    <button class="btn-classic" onclick="validarYHabilitar()">Registrar habilitación de cuestionario incremental</button>
                </div>

                <div class="footer-bar">
                    <button class="btn-classic" onclick="navigateTo('inicio')">Salir</button>
                    <button class="btn-classic" style="font-weight: bold;" onclick="navigateTo('registro')">Registrar nuevo cuestionario incremental</button>
                </div>

            </div>
            
            <!-- AÑADIDO: Menú Contextual (Oculto) -->
            <div id="column-context-menu">
                <ul id="column-menu-list">
                    <!-- Las columnas se generarán aquí por JS -->
                </ul>
            </div>
            
        </div>
    </div>	


    <!-- VISTA DE REGISTRO (Registro nuevo cuestionario incremental) -->
    <div id="registro-view" class="view">
        
        <div class="text-center mt-4">
             <button onclick="navigateTo('consultar')" class="text-sm text-violet-600 hover:underline">&larr; Volver a Consultar</button>
        </div>
        
        <div id="registro-view-container">
            <div class="window-title-bar">
                <h1>Registrar nuevo cuestionario incremental</h1>
                <div class="window-controls">
                    <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15" /></svg></span>
                    <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 2.25h19.5v19.5H2.25V2.25z" /></svg></span>
                    <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg></span>
                </div>
            </div>

            <div class="window-body">
                
                <div class="info-fields">
                    <div class="filter-group">
                        <label for="r-fecha">Fecha:</label>
                        <input type="text" id="r-fecha" class="input-text input-readonly" value="dd/mm/aaaa" style="width: 70px;" readonly>
                    </div>
                    <div class="filter-group">
                        <label for="r-usuario">Usuario:</label>
                        <input type="text" id="r-usuario" class="input-text input-readonly" value="UsuarioActual" readonly>
                    </div>
                </div>

                <div class="flex flex-col gap-4">
                    
                    <div class="flex gap-4">
                         <div class="filter-group flex-1">
                            <label for="r-titulo-incremento">Título Incremento:</label>
                            <input type="text" id="r-titulo-incremento" class="input-text flex-1">
                        </div>
                        <div class="filter-group">
                            <label for="r-tipo-incremento">Tipo Incremento:</label>
                            <select id="r-tipo-incremento" class="input-select" onchange="toggleIncrementType(this.value)">
                                <option value="Formativo">Formativo</option>
                                <option value="Final">Final</option>
                            </select>
                        </div>
                    </div>

                    <div id="dynamic-content">
                        <div id="formativo-section" class="filter-fieldset" style="display: block; gap: 0;">
                            <div class="font-bold mb-2">Banco de preguntas</div>
                            <div class="flex gap-4 mb-3 items-center">
                                <div class="filter-group">
                                    <label for="r-unidad">Unidad:</label>
                                    <select id="r-unidad" class="input-select" style="width: 70px;">
                                        <option value="">(Todas)</option>
                                        <option>U-01</option><option>U-02</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="r-estado">Estado:</label>
                                    <select id="r-estado" class="input-select" style="width: 90px;">
                                        <option value="">(Todos)</option>
                                        <option>Activo</option><option>Inactivo</option>
                                    </select>
                                </div>
                                <button class="btn-classic">Buscar</button>
                            </div>
                            
                            <div class="table-container" style="max-height: 150px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Número</th>
                                            <th>Pregunta</th>
                                            <th>Estado</th>
                                            <th class="col-seleccion">Seleccionar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bank-questions-body">
                                        <tr><td>1</td> <td>¿Qué es la dilatación térmica?</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" data-numero="1" data-pregunta="¿Qué es la dilatación térmica?" onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>2</td> <td>Defina el Teorema de Pitágoras.</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" data-numero="2" data-pregunta="Defina el Teorema de Pitágoras." onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>3</td> <td>Leyes de Newton.</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" data-numero="3" data-pregunta="Leyes de Newton." onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>4</td> <td>¿Qué fue la Revolución Francesa?</td> <td>Inactivo</td> <td class="col-seleccion"><input type="checkbox" data-numero="4" data-pregunta="¿Qué fue la Revolución Francesa?" onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>5</td> <td>Capital de Argentina.</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" data-numero="5" data-pregunta="Capital de Argentina." onchange="updateTotalQuestions()"></td></tr>
                                    </tbody>
                                </table>
                            </div>
                            
                        </div>
                        
                        <div id="final-section" class="filter-fieldset" style="display: none; flex-direction: column; gap: 0;">
                            <div class="font-bold mb-2">Cuestionarios Completados (Fuente de preguntas con mayor error)</div>
                            
                            <div class="table-container" style="max-height: 150px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Número Cuest.</th>
                                            <th>Unidad</th>
                                            <th>Fecha Completado</th>
                                            <th>Tasa de Error Prom.</th>
                                            <th class="col-seleccion">Seleccionar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="completed-quizzes-body">
                                        <tr><td>1002</td> <td>U-02</td> <td>11/11/2025</td> <td>65%</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions(true)"></td></tr>
                                        <tr><td>1008</td> <td>U-03</td> <td>15/11/2025</td> <td>80%</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions(true)"></td></tr>
                                        <tr><td>1012</td> <td>U-03</td> <td>19/11/2025</td> <td>45%</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions(true)"></td></tr>
                                    </tbody>
                                </table>
                            </div>
                             <div class="text-xs text-gray-600 mt-1">
                                Nota: Al crear, se seleccionarán automáticamente las preguntas con la mayor tasa de error de los cuestionarios marcados.
                            </div>
                        </div>
                    </div>


                    <div class="flex flex-col gap-2 p-2" style="border: 1px dashed #C0C0C0;">
                        <div class="flex gap-10 items-center">
                            <div class="filter-group">
                                <label for="r-total-preguntas">Total preguntas seleccionadas:</label>
                                <input type="text" id="r-total-preguntas" class="input-text input-readonly" value="0" readonly style="width: 40px; background-color: #F0F0F0;">
                            </div>
                        </div>
                        
                        <div class="flex gap-4 items-center">
                            <div class="filter-group">
                                <label for="r-calif-total">Calificación Total:</label>
                                <input type="text" id="r-calif-total" class="input-text" value="" style="width: 60px;">
                            </div>
                             <div class="filter-group">
                                <label for="r-tipo-puntaje">Tipo Puntaje:</label>
                                <select id="r-tipo-puntaje" class="input-select" style="width: 90px;">
                                    <option>Porcentaje</option>
                                    <option>Puntos</option>
                                </select>
                            </div>
                            <div class="filter-group ml-8">
                                <label>Ordenar preguntas al azar:</label>
                                <input type="radio" name="order-type" checked>
                            </div>
                            <div class="filter-group">
                                <label>Barajar respuestas:</label>
                                <input type="radio" name="order-type">
                            </div>
                        </div>

                        <div class="flex justify-center mt-3">
                            <button id="btnCrear" class="btn-classic" style="font-weight: bold; background-color: #D6D6A8;" onclick="toggleQuestionEditor()">Crear</button>
                        </div>
                    </div>


                    <div id="question-editor" class="question-editor-container" style="display:none;">
                        <div class="font-bold text-base mb-2">Detalle de Preguntas Generadas:</div>
                        
                        <div id="dynamic-question-list" style="max-height: 350px; overflow-y: auto; padding-right: 5px; border: 1px solid #C0C0C0; padding: 5px; background-color: #F8F8F0;">
                            <!-- Las preguntas generadas por JS irán aquí -->
                        </div>

                        <div class="flex justify-end gap-2 mt-4">
                            <button class="btn-classic" onclick="toggleQuestionEditor(true)">Cancelar</button>
                            <button class="btn-classic" style="font-weight: bold; background-color: #B2D8B2;">Confirmar</button>
                        </div>
                    </div>

                </div>
                
                <div class="footer-bar mt-4">
                    <button class="btn-classic" onclick="navigateTo('inicio')">Salir</button>
                    <button class="btn-classic" style="font-weight: bold;">confirmar registracion nuevo cuestionario incremental</button>
                </div>

            </div>
        </div>
    </div>


    <!-- VISTA DE HABILITACIÓN (NUEVA) -->
    <div id="habilitacion-view" class="view">
        
        <div class="text-center mt-4">
             <button onclick="navigateTo('consultar')" class="text-sm text-violet-600 hover:underline">&larr; Volver a Consultar</button>
        </div>
        
        <div id="habilitacion-view-container">
            <div class="window-title-bar">
                <h1>Registrar habilitación de cuestionario incremental</h1>
                <div class="window-controls">
                    <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15" /></svg></span>
                    <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 2.25h19.5v19.5H2.25V2.25z" /></svg></span>
                    <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg></span>
                </div>
            </div>

            <div class="window-body">
                
                <fieldset class="filter-fieldset">
                    <legend>Cuestionario seleccionado</legend>
                    <div class="filter-group">
                        <label>Cuestionario:</label>
                        <input type="text" class="input-text input-readonly" value="1001" readonly style="width: 50px;">
                    </div>
                    <div class="filter-group">
                        <label>Materia:</label>
                        <input type="text" class="input-text input-readonly" value="Materia Ejemplo" readonly style="width: 150px;">
                    </div>
                     <div class="filter-group">
                        <label>Unidad:</label>
                        <input type="text" class="input-text input-readonly" value="U-01" readonly style="width: 40px;">
                    </div>
                </fieldset>

                <div class="flex flex-wrap md:flex-nowrap gap-4">
                
                    <div class="flex-1 w-full md:w-1/2">
                        <fieldset class="filter-fieldset" style="height: 100%; flex-direction: column; align-items: flex-start;">
                            <legend>Configuración General</legend>
                            <div class="filter-group w-full">
                                <label for="h-desc" style="align-self: flex-start; margin-top: 4px;">Descripción:</label>
                                <textarea id="h-desc" class="input-text" style="width: 100%; height: 60px; min-width: 200px;"></textarea>
                            </div>
                            <div class="filter-group w-full mt-2" style="flex-wrap: wrap;">
                                <input type="checkbox" id="h-req-pass" onchange="document.getElementById('h-pass').disabled = !this.checked; document.getElementById('h-pass').classList.toggle('input-readonly', !this.checked);">
                                <label for="h-req-pass">Requiere Contraseña:</label>
                                <label for="h-pass" style="margin-left: 10px;">Contraseña:</label>
                                <input type="password" id="h-pass" class="input-text input-readonly" style="width: 120px;" disabled>
                            </div>
                        </fieldset>
                    </div>
                    
                    <div class="flex-1 w-full md:w-1/2 flex flex-col gap-3">
                        <fieldset class="filter-fieldset" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                            <legend>Detalles de Habilitación</legend>
                            <div class="filter-group">
                                <label style="width: 110px;">Usuario que habilita:</label>
                                <input type="text" class="input-text input-readonly" value="AdminSystem" readonly>
                            </div>
                            <div class="filter-group">
                                <label style="width: 110px;">Fecha de Habilitación:</label>
                                <input type="text" class="input-text" value="13/11/2025" style="width: 80px;"> 
                            </div>
                             <div class="filter-group">
                                <label style="width: 110px;">Horario Habilitación:</label>
                                <input type="text" class="input-text" value="09:00" style="width: 50px;"> 
                            </div>
                        </fieldset>
                        
                        <fieldset class="filter-fieldset" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                            <legend>Periodo de validez</legend>
                            <div class="filter-group">
                                <label style="width: 110px;">Fecha de caducidad:</label>
                                <input type="text" class="input-text" value="20/11/2025" style="width: 80px;">
                            </div>
                             <div class="filter-group">
                                <label style="width: 110px;">Horario de caducidad:</label>
                                <input type="text" class="input-text" value="23:59" style="width: 50px;">
                            </div>
                        </fieldset>
                    </div>
                </div>

                 <fieldset class="filter-fieldset mt-3" style="flex-direction: column;">
                    <legend>Preguntas del cuestionario</legend>
                    <div class="table-container" style="max-height: 200px; margin-bottom: 0;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ítem</th>
                                    <th>Pregunta</th>
                                    <th>Respuesta</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>1</td><td>¿Qué es el Big Bang?</td><td>Expansión inicial del universo.</td><td>Activa</td></tr>
                                <tr><td>2</td><td>Capital de Chile.</td><td>Santiago.</td><td>Activa</td></tr>
                                <tr><td>3</td><td>Fórmula del agua.</td><td>H2O</td><td>Activa</td></tr>
                                <tr><td>4</td><td>¿Quién escribió El Quijote?</td><td>Miguel de Cervantes</td><td>Activa</td></tr>
                                <tr><td>5</td><td>¿Cuántos huesos tiene el cuerpo humano adulto?</td><td>206</td><td>Activa</td></tr>
                                <tr><td>6</td><td>¿Qué es la fotosíntesis?</td><td>Proceso vegetal...</td><td>Activa</td></tr>
                                 <tr><td>7</td><td>(Pregunta de ejemplo)</td><td>(Respuesta de ejemplo)</td><td>Activa</td></tr>
                                <tr><td>8</td><td>(Pregunta de ejemplo)</td><td>(Respuesta de ejemplo)</td><td>Activa</td></tr>
                            </tbody>
                        </table>
                    </div>
                </fieldset>

                <div class="footer-bar">
                    <button class="btn-classic" onclick="navigateTo('consultar')">Cancelar</button>
                    <button class="btn-classic" style="font-weight: bold;">Registrar confirmacion de habilitacion de cuestionario incremental</button>
                </div>

            </div>
        </div>
    </div>

   
    <!-- MODAL DE ERROR (MODIFICADO A ESTILO MODERNO) -->
    <div id="error-modal" class="modal-overlay">
        <div class="bg-gray-900/80 backdrop-blur-sm rounded-xl shadow-2xl p-6 max-w-sm w-full border border-violet-700 text-white fade-in-card">
            
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-violet-300">Error de Validación</h2>
                <svg onclick="cerrarError()" class="w-6 h-6 text-gray-400 hover:text-white cursor-pointer" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </div>

            <div class="modal-body-modern mb-6">
                <p id="error-message" class="text-violet-100">Mensaje de error irá aquí.</p>
            </div>
            
            <div class="flex justify-end">
                <button onclick="cerrarError()" 
                        class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-2 px-6 rounded-full shadow-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-violet-300">
                    Aceptar
                </button>
            </div>
        </div>
    </div>

     
    <!-- JavaScript para Lógica de Vistas y Dinámicas -->
    <script>
        // Objeto global para el estado de la tabla
        const tableState = {
            columnVisibility: {
                numero: true,
                unidad: true,
                tipo: true,
                estado: true,
                fecha: true,
                cantidad: true,
                visualizar: true,
                seleccion: true
            }
        };

        // Inicializa el total de seleccionados en la vista de consulta
        document.addEventListener('DOMContentLoaded', () => {
             updateTotalSelected();
             // Asignar fecha actual al campo de registro (simulado)
             const dateFields = [document.getElementById('r-fecha'), document.getElementById('f-fecha')];
             const today = new Date();
             const d = String(today.getDate()).padStart(2, '0');
             const m = String(today.getMonth() + 1).padStart(2, '0');
             const y = today.getFullYear();
             const formattedDate = `${d}/${m}/${y}`;
             
             dateFields.forEach(field => {
                 if (field && (field.value === 'dd/mm/aaaa' || field.value === '')) {
                     field.value = formattedDate;
                 }
             });
             
             // Ocultar el menú contextual si se hace clic fuera
             document.addEventListener('click', () => {
                 document.getElementById('column-context-menu').style.display = 'none';
             });
        });

        // 1. Lógica de Navegación de Vistas
        function navigateTo(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            const targetView = document.getElementById(viewId + '-view');
            if (targetView) {
                targetView.classList.add('active');
            }
        }
        
        // 2. Lógica para actualizar el contador de seleccionados en la vista de CONSULTAR
        function updateTotalSelected() {
            const checkboxes = document.querySelectorAll('#consultar-view-container input[type="checkbox"]');
            let count = 0;
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    count++;
                }
            });
            const totalInput = document.getElementById('f-total');
            if (totalInput) {
                totalInput.value = count;
            }
        }

        // --- MODIFICADO: FUNCIONES PARA MODAL MODERNO ---
        function mostrarError(mensaje) {
            const modal = document.getElementById('error-modal');
            const messageP = document.getElementById('error-message');
            if (modal && messageP) {
                messageP.textContent = mensaje;
                modal.classList.add('active');
            }
        }

        function cerrarError() {
            const modal = document.getElementById('error-modal');
            if (modal) {
                modal.classList.remove('active');
            }
        }
        // --- FIN DE FUNCIONES DE MODAL ---


        // --- NUEVA FUNCIÓN DE VALIDACIÓN (HABILITACIÓN) ---
        function validarYHabilitar() {
            const totalInput = document.getElementById('f-total');
            let count = 0;
            
            if (totalInput) {
                count = parseInt(totalInput.value, 10);
            }

            if (isNaN(count)) {
                count = 0; 
            }

            if (count === 0) {
                mostrarError('Debe seleccionar al menos un cuestionario para habilitar.');
                return; 
            }
            
            if (count > 1) {
                mostrarError('Solo puede habilitar un cuestionario a la vez. Por favor, seleccione solo uno.');
                return; 
            }

            if (count === 1) {
                navigateTo('habilitacion');
            }
        }


        // 3. Lógica dinámica para la vista de REGISTRO (Formativo vs. Final)
        function toggleIncrementType(type) {
            const formativoSection = document.getElementById('formativo-section');
            const finalSection = document.getElementById('final-section');
            const editor = document.getElementById('question-editor');

            editor.style.display = 'none'; 

            if (type === 'Final') {
                formativoSection.style.display = 'none';
                finalSection.style.display = 'flex';
            } else { 
                formativoSection.style.display = 'block';
                finalSection.style.display = 'none';
            }
            updateTotalQuestions();
        }

        // 4. Lógica para actualizar el contador de preguntas en la vista de REGISTRO
        function updateTotalQuestions(isFinal = false) {
            let selector = '#formativo-section input[type="checkbox"]';
            if (document.getElementById('r-tipo-incremento').value === 'Final' || isFinal) {
                selector = '#final-section input[type="checkbox"]';
            }
            
            const checkboxes = document.querySelectorAll(selector);
            let count = 0;
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    count++;
                }
            });

            const totalInput = document.getElementById('r-total-preguntas');
            if (totalInput) {
                totalInput.value = count;
            }
        }
        
        // 5. Lógica para mostrar/ocultar el Editor de Preguntas
        function toggleQuestionEditor(cancel = false) {
            const editor = document.getElementById('question-editor');
            const listContainer = document.getElementById('dynamic-question-list');
            const btnCrear = document.getElementById('btnCrear');
            const tipo = document.getElementById('r-tipo-incremento').value;

            if (editor.style.display === 'block' || cancel) {
                 editor.style.display = 'none';
                 btnCrear.textContent = 'Crear';
                 listContainer.innerHTML = ''; 
                 return;
            }
            
            listContainer.innerHTML = ''; 

            if (tipo === 'Formativo') {
                const selectedQuestions = document.querySelectorAll('#formativo-section input[type="checkbox"]:checked');
                
                if (selectedQuestions.length === 0) {
                    mostrarError('Debe seleccionar al menos una pregunta del banco para crear un cuestionario formativo.');
                    return;
                }

                let questionIndex = 1;
                selectedQuestions.forEach(chk => {
                    const questionText = chk.dataset.pregunta;
                    const questionHtml = crearHtmlEditorPregunta(questionIndex, questionText, '', false);
                    listContainer.insertAdjacentHTML('beforeend', questionHtml);
                    questionIndex++;
                });

            } else { // tipo === 'Final'
                const selectedQuizzes = document.querySelectorAll('#final-section input[type="checkbox"]:checked');
                
                if (selectedQuizzes.length === 0) {
                    mostrarError('Debe seleccionar al menos un cuestionario completado como fuente para el tipo "Final".');
                    return;
                }
                
                listContainer.innerHTML = `<div class="p-2 text-xs text-gray-700" style="margin-bottom: 5px; background-color: #FFF; border: 1px dashed #AAA;"><i><b>Simulación:</b> Creando cuestionario con preguntas de mayor tasa de error de los ${selectedQuizzes.length} cuestionarios fuente seleccionados. El profesor puede revisar y ajustar puntajes.</i></div>`;
                
                listContainer.insertAdjacentHTML('beforeend', crearHtmlEditorPregunta(1, "Pregunta Simulada (Error 80%): ¿Qué fue la Revolución Francesa?", "10", true));
                listContainer.insertAdjacentHTML('beforeend', crearHtmlEditorPregunta(2, "Pregunta Simulada (Error 65%): Leyes de Newton.", "10", true));
                listContainer.insertAdjacentHTML('beforeend', crearHtmlEditorPregunta(3, "Pregunta Simulada (Error 60%): Capital de Argentina.", "5", true));
            }

            editor.style.display = 'block';
            btnCrear.textContent = 'Recargar Editor';
        }

        // 6. Helper para crear el HTML del editor de preguntas
        function crearHtmlEditorPregunta(index, questionText, puntaje = '', isFinal = false) {
            const readOnlyAttr = isFinal ? 'readonly class="input-text input-readonly"' : 'class="input-text"';
            const puntajeValue = puntaje || '';
            
            return `
            <div class="question-item border p-2 mb-3 bg-white" style="border: 1px solid #999;">
                <div class="question-row-header">
                    <div class="flex gap-2 flex-wrap">
                        <label style="width: 100px;">Número Pregunta:</label>
                        <input type="text" class="input-text input-readonly" value="${index}" style="width: 30px;" readonly>
                        <label>Obligatorio:</label>
                        <input type="checkbox" checked>
                        <label style="margin-left: 20px;">Puntaje:</label>
                        <input type="text" class="input-text" style="width: 40px;" value="${puntajeValue}">
                    </div>
                </div>
                <div class="question-row mt-2">
                    <label style="width: 150px;">Nombre Pregunta:</label>
                    <input type="text" ${readOnlyAttr} value="${questionText}" style="flex: 1;">
                    <button class="btn-classic">Registrar Imagen</button>
                </div>
                <div class="mt-2 ml-4 p-2 border-l border-dashed border-gray-400">
                    <div class="question-row">
                        <label class="field-label">1. Respuesta:</label>
                        <input type="text" class="input-text flex-1" value="">
                        <label>Porcentaje:</label>
                        <input type="text" class="input-text" style="width: 40px;">%
                        <label>Retro:</label>
                        <input type="text" class="input-text flex-1">
                        <input type="checkbox">
                    </div>
                    <div class="question-row">
                        <label class="field-label">2. Respuesta:</label>
                        <input type="text" class="input-text flex-1" value="">
                        <label>Porcentaje:</label>
                        <input type="text" class="input-text" style="width: 40px;">%
                        <label>Retro:</label>
                        <input type="text" class="input-text flex-1">
                        <input type="checkbox">
                    </div>
                    <div class="question-row">
                        <label class="field-label" style="font-style: italic;">n. Respuesta:</label>
                        <input type="text" class="input-text flex-1" value="">
                        <label>Porcentaje:</label>
                        <input type="text" class="input-text" style="width: 40px;">%
                        <label>Retro:</label>
                        <input type="text" class="input-text flex-1">
                        <input type="checkbox">
                    </div>
                </div>
            </div>
            `;
        }
        
        // 7. Inicializar la vista dinámica y el contador
        // (Movido a DOMContentLoaded)
        
        // --- AÑADIDO: Lógica de Ordenamiento de Tabla (Click Izquierdo) ---
        function sortTable(th, colIndex) {
            const table = document.getElementById('consultar-tabla');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Determinar dirección de orden
            let currentDir = th.dataset.sortDir || 'desc';
            let newDir = (currentDir === 'asc') ? 'desc' : 'asc';
            th.dataset.sortDir = newDir;

            // Quitar clases de orden de otros headers
            table.querySelectorAll('th.sortable').forEach(h => {
                h.classList.remove('sorted-asc', 'sorted-desc');
            });

            // Añadir clase de orden actual
            th.classList.add(newDir === 'asc' ? 'sorted-asc' : 'sorted-desc');

            // Lógica de ordenamiento
            rows.sort((rowA, rowB) => {
                let valA = rowA.cells[colIndex].textContent.trim();
                let valB = rowB.cells[colIndex].textContent.trim();
                
                // Tratar como números si es 'numero' o 'cantidad'
                const colName = th.dataset.col;
                if (colName === 'numero' || colName === 'cantidad') {
                    valA = parseFloat(valA) || 0;
                    valB = parseFloat(valB) || 0;
                } 
                // Tratar como fechas (dd/mm/yyyy)
                else if (colName === 'fecha') {
                    valA = parseDate(valA);
                    valB = parseDate(valB);
                }
                // String compare (case-insensitive)
                else {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (valA < valB) {
                    return newDir === 'asc' ? -1 : 1;
                }
                if (valA > valB) {
                    return newDir === 'asc' ? 1 : -1;
                }
                return 0;
            });

            // Re-adjuntar filas
            rows.forEach(row => tbody.appendChild(row));
        }
        
        // Helper para convertir fecha dd/mm/yyyy a objeto Date
        function parseDate(dateStr) {
            const parts = dateStr.split('/');
            if (parts.length === 3) {
                // new Date(year, monthIndex, day)
                return new Date(parts[2], parts[1] - 1, parts[0]);
            }
            return new Date(0); // Fecha inválida
        }

        // --- AÑADIDO: Lógica de Menú Contextual (Click Derecho) ---
        function showColumnMenu(event) {
            event.preventDefault(); // Evitar menú del navegador
            event.stopPropagation(); // Evitar que se cierre solo
            
            const menu = document.getElementById('column-context-menu');
            const menuList = document.getElementById('column-menu-list');
            
            // Rellenar menú (solo la primera vez, o si cambia)
            if (menuList.childElementCount === 0) {
                const headers = document.querySelectorAll('#consultar-tabla th');
                headers.forEach(th => {
                    const colName = th.dataset.col;
                    const colText = th.querySelector('.th-content span') ? th.querySelector('.th-content span').textContent : th.textContent;
                    
                    if (!colName) return; // Si no tiene data-col, no se puede ocultar

                    const li = document.createElement('li');
                    li.textContent = colText;
                    li.dataset.col = colName;
                    
                    // Marcar si está visible
                    if (tableState.columnVisibility[colName]) {
                        li.classList.add('checked');
                    }
                    
                    li.onclick = () => {
                        toggleColumn(colName);
                        menu.style.display = 'none'; // Ocultar después de la acción
                    };
                    menuList.appendChild(li);
                });
            } else {
                 // Actualizar checks
                 menuList.querySelectorAll('li').forEach(li => {
                    const colName = li.dataset.col;
                    if (tableState.columnVisibility[colName]) {
                        li.classList.add('checked');
                    } else {
                        li.classList.remove('checked');
                    }
                 });
            }

            // Posicionar y mostrar menú
            const rect = event.currentTarget.getBoundingClientRect();
            const containerRect = document.getElementById('consultar-view-container').getBoundingClientRect();
            
            // Posicionarlo relativo al contenedor de la ventana
            menu.style.top = (rect.bottom - containerRect.top) + 'px';
            menu.style.left = (rect.left - containerRect.left) + 'px';
            menu.style.display = 'block';
        }
        
        function toggleColumn(colName) {
            const isVisible = tableState.columnVisibility[colName];
            const newState = !isVisible;
            tableState.columnVisibility[colName] = newState;

            // Ocultar/Mostrar todas las celdas (th y td) con ese data-col
            const cells = document.querySelectorAll(`#consultar-tabla [data-col="${colName}"]`);
            cells.forEach(cell => {
                if (newState) {
                    cell.style.display = ''; // Volver al display por defecto
                    cell.style.opacity = 1;
                } else {
                    cell.style.display = 'none'; // Ocultar
                    cell.style.opacity = 0;
                }
            });
        }


    </script>

</body>
</html>
