<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototipo QuizMind v2</title>
    <!-- Incluyendo Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- ESTILOS COMPARTIDOS (Estilo Windows Clásico) --- */
        
        /* Ocultar vistas no activas */
        .view {
            display: none;
        }
        .view.active {
            display: block;
        }
        
        /* Contenedor de la ventana de aplicación */
        /* MODIFICADO: Añadido #habilitacion-view-container */
        #consultar-view-container, #registro-view-container, #habilitacion-view-container {
            font-family: 'Tahoma', 'MS Sans Serif', Arial, sans-serif;
            font-size: 11px;
            background-color: #ECE9D8; /* Color de fondo de ventana clásico */
            border: 1px solid #000;
            width: 800px; 
            margin: 2rem auto;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.3);
        }

        /* Barra de título azul */
        .window-title-bar {
            background: linear-gradient(to right, #0058A8, #A6CAF0);
            padding: 4px 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #000;
        }
        .window-title-bar h1 {
            color: white;
            font-weight: bold;
            font-size: 12px;
            margin: 0;
        }
        /* Botones falsos de min/max/cerrar */
        .window-controls {
            display: flex;
            gap: 2px;
        }
        .window-controls span {
            width: 18px;
            height: 18px;
            background-color: #ECE9D8;
            border: 1px solid #666;
            font-family: 'Webdings', 'Marlett';
            font-size: 12px;
            text-align: center;
            line-height: 18px;
            cursor: default;
        }

        .window-body {
            padding: 10px;
        }

        /* Campos de Info (Fecha y Usuario) */
        .info-fields {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            padding: 5px;
        }

        /* Grupo de filtros / Fieldset general */
        .filter-fieldset {
            border: 1px solid #ACA899;
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }
        /* Estilo para la leyenda (título del fieldset) */
        .filter-fieldset legend {
            font-weight: bold;
            margin-left: 10px;
            padding: 0 4px;
            background-color: #ECE9D8; /* Debe coincidir con el fondo */
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .filter-group label {
            font-size: 11px;
            white-space: nowrap;
        }
        /* Inputs y Selects */
        .input-text, .input-select {
            font-size: 11px;
            padding: 2px;
            border: 1px solid #7F9DB9;
            background-color: #FFFFFF;
        }
        .input-text {
            min-width: 80px;
        }
        /* Input de solo lectura */
        .input-readonly {
             background-color: #F0F0F0;
        }
        
        /* Botón clásico */
        .btn-classic {
            font-size: 11px;
            background-color: #ECE9D8;
            border: 1px solid #666;
            box-shadow: 1px 1px 1px #FFF;
            padding: 3px 12px;
            cursor: pointer;
            outline: none;
        }
        .btn-classic:hover {
            border: 1px solid #000;
        }
        .btn-classic:active {
            box-shadow: inset 1px 1px 1px #888;
            background-color: #D6D6C8;
        }

        /* Contenedor de la tabla con scroll */
        .table-container {
            border: 1px solid #7F9DB9;
            max-height: 300px; /* Altura para forzar el scroll */
            overflow-y: scroll;
            background-color: #FFFFFF;
            margin-bottom: 10px;
            width: 100%; /* Asegura que ocupe todo el fieldset */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #DDD;
            padding: 4px 6px;
            white-space: nowrap;
            text-align: left;
        }
        th {
            background-color: #D6D6C8; /* Cabecera de tabla más gris */
            font-weight: bold;
            position: sticky;
            top: 0;
            border-bottom: 1px solid #ACA899;
            z-index: 10;
        }
        td.col-visualizar a {
            color: blue;
            text-decoration: underline;
            cursor: pointer;
        }
        td.col-seleccion, th.col-seleccion {
            text-align: center;
            width: 50px;
        }

        /* Barra de pie de página */
        .footer-bar {
            border-top: 1px solid #ACA899;
            padding-top: 10px;
            display: flex;
            justify-content: flex-end;
            gap: 6px;
        }
        
        /* Estilos específicos para el Editor de Preguntas (Wireframe) */
        .question-editor-container {
            border: 1px solid #ACA899; 
            padding: 10px; 
            margin-top: 15px;
            background-color: #F0F0E8; /* Ligero cambio de color para el área de edición */
        }
        .question-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }
        .question-row-header {
             margin-top: 10px;
             padding-bottom: 5px;
             border-bottom: 1px solid #C0C0C0;
             font-weight: bold;
        }
        .field-label {
            width: 80px; /* Ancho fijo para etiquetas de campo */
            text-align: right;
        }

        /* --- ESTILOS DE MODAL DE ERROR --- */
        .modal-overlay {
            display: none; /* Oculto por defecto */
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.5); /* Fondo oscuro semitransparente */
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-window {
            background-color: #ECE9D8;
            border: 1px solid #000;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.5);
            width: 350px;
            font-family: 'Tahoma', Arial, sans-serif;
            font-size: 11px;
        }
        .modal-body {
            padding: 20px;
            text-align: center;
        }
        .modal-body p {
            margin-bottom: 20px;
            font-size: 12px;
        }
        /* Usar el footer-bar para el botón */
        .modal-window .footer-bar {
            padding: 8px 10px;
            justify-content: center;
            background-color: #D6D6C8;
            border-top: 1px solid #ACA899;
        }

    </style>
</head>
<body class="bg-violet-100 font-sans" 
    style="background-image: url('https://www.shutterstock.com/image-illustration/ai-brain-artificial-intelligence-neural-600nw-2614012815.jpg'); 
            background-size: cover; 
            background-position: center; 
            background-attachment: fixed;">

    
<!-- VISTA DE INICIO (Simple) -->
    <div id="inicio-view" class="view active">
        <div class="min-h-screen flex flex-col items-center justify-center text-center p-8">
            <div class="bg-gray-900/80 backdrop-blur-sm rounded-xl shadow-2xl p-10 max-w-xl w-full border border-violet-700">
                
                <!-- Logo - Usamos un placeholder seguro ya que la ruta local no es válida -->
                <img src="https://github.com/Thiagodecalli/quizzmind/blob/main/imagenproyecto.png" 
                     class="h-32 w-32 rounded-full shadow-xl mb-6 mx-auto border-4 border-violet-400">
                
                <h1 class="text-5xl font-extrabold text-white mb-4 tracking-wider">QuizMind</h1>
                <p class="text-lg text-violet-200 mb-10 max-w-md mx-auto">
                    Un Cambio en el estudio haciéndolo un poco más autodidacta y mejorando la medida de 
                    efectividad que tiene nuestro aprendizaje.
                </p>
                
                <button onclick="navigateTo('consultar')" 
                        class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 text-lg uppercase tracking-wider focus:outline-none focus:ring-4 focus:ring-violet-300">
                    Consultar Cuestionarios Incrementales
                </button>
            </div>
        </div>
    </div>

    <!-- VISTA DE CONSULTA -->
    <div id="consultar-view" class="view">
        
        <!-- Botón para volver al inicio -->
        <div class="text-center mt-4">
             <button onclick="navigateTo('inicio')" class="text-sm text-violet-600 hover:underline">&larr; Volver al Inicio</button>
        </div>
        
        <!-- Contenedor de la Ventana -->
        <div id="consultar-view-container">
            <!-- Barra de Título -->
            <div class="window-title-bar">
                <h1>Consultar cuestionarios incrementales</h1>
                <div class="window-controls">
                    <span>_</span><span>&#9633;</span><span>X</span>
                </div>
            </div>

            <!-- Cuerpo de la Ventana -->
            <div class="window-body">
                
                <!-- CAMPOS DE INFO (Fecha y Usuario) -->
                <div class="info-fields">
                    <div class="filter-group">
                        <label for="f-fecha">Fecha:</label>
                        <!-- MODIFICADO: Campo de solo lectura -->
                        <input type="text" id="f-fecha" class="input-text input-readonly" value="dd/mm/aaaa" style="width: 70px;" readonly>
                    </div>
                    <div class="filter-group">
                        <label for="f-usuario">Usuario:</label>
                        <!-- MODIFICADO: Campo de solo lectura -->
                        <input type="text" id="f-usuario" class="input-text input-readonly" value="UsuarioActual" readonly>
                    </div>
                </div>

                <!-- Filtros -->
                <fieldset class="filter-fieldset">
                    <div class="filter-group">
                        <label for="f-materia">Materia:</label>
                        <select id="f-materia" class="input-select" style="width: 100px;">
                            <option value="">(Todas)</option>
                            <option value="matematicas">Matemáticas</option>
                            <option value="historia">Historia</option>
                            <option value="literatura">Literatura</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="f-unidad">Unidad:</label>
                        <select id="f-unidad" class="input-select" style="width: 70px;">
                            <option value="">(Todas)</option>
                            <option value="U-01">U-01</option>
                            <option value="U-02">U-02</option>
                            <option value="U-03">U-03</option>
                            <option value="U-04">U-04</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="f-tipo">Tipo incremento:</label>
                        <select id="f-tipo" class="input-select" style="width: 100px;">
                            <option>(Todos)</option>
                            <option>Formativo</option>
                            <option>Final</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="f-ordenar">Ordenar:</label>
                        <select id="f-ordenar" class="input-select" style="width: 100px;">
                            <option>Fecha (Desc.)</option>
                            <option>Número (Asc.)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="btn-classic" style="margin-left: 10px;">Buscar</button>
                    </div>
                </fieldset>

                <!-- Tabla -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Unidad</th>
                                <th>Tipo Incremento</th>
                                <th>Estado</th>
                                <th>Fecha Creación</th>
                                <th>Cantidad Preguntas</th>
                                <th>Visualizar</th>
                                <th class="col-seleccion">Selección</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>1001</td> <td>U-01</td> <td>Formativo</td> <td>Sin completar</td> <td>10/11/2025</td> <td>10</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1002</td> <td>U-02</td> <td>Formativo</td> <td>Completado</td> <td>11/11/2025</td> <td>5</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1003</td> <td>U-01</td> <td>Formativo</td> <td>Sin completar</td> <td>12/11/2025</td> <td>8</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1004</td> <td>U-03</td> <td>Formativo</td> <td>Sin completar</td> <td>12/11/2025</td> <td>10</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1005</td> <td>U-02</td> <td>Formativo</td> <td>Sin completar</td> <td>13/11/2025</td> <td>6</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1006</td> <td>U-04</td> <td>Formativo</td> <td>Completado</td> <td>13/11/2025</td> <td>12</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1007</td> <td>U-01</td> <td>Formativo</td> <td>Sin completar</td> <td>14/11/2025</td> <td>15</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1008</td> <td>U-03</td> <td>Formativo</td> <td>Completado</td> <td>15/11/2025</td> <td>7</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1009</td> <td>U-04</td> <td>Formativo</td> <td>Sin completar</td> <td>16/11/2025</td> <td>10</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1010</td> <td>U-01</td> <td>Formativo</td> <td>Sin completar</td> <td>17/11/2025</td> <td>9</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1011</td> <td>U-02</td> <td>Formativo</td> <td>Sin completar</td> <td>18/11/2025</td> <td>11</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                            <tr><td>1012</td> <td>U-03</td> <td>Formativo</td> <td>Completado</td> <td>19/11/2025</td> <td>5</td> <td class="col-visualizar"><a>Ver</a></td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalSelected()"></td></tr>
                        </tbody>
                    </table>
                </div>

               <!-- Barra de Total y Botón Habilitación -->
                <div class="total-bar flex justify-between items-center mb-4">
                    <div class="filter-group">
                        <label for="f-total">Total de incrementos seleccionados:</label>
                        <input type="text" id="f-total" class="input-text input-readonly" value="0" readonly style="width: 40px;">
                    </div>
                    <!-- MODIFICADO: onclick llama a la validación -->
                    <button class="btn-classic" onclick="validarYHabilitar()">Registrar habilitación de cuestionario incremental</button>
                </div>

                <!-- Barra de Pie de página -->
                <div class="footer-bar">
                    <button class="btn-classic" onclick="navigateTo('inicio')">Salir</button>
                    <!-- MODIFICADO: Navega a la nueva vista de registro -->
                    <button class="btn-classic" style="font-weight: bold;" onclick="navigateTo('registro')">Registrar nuevo cuestionario incremental</button>
		    
                </div>

            </div>
        </div>
    </div>	


    <!-- VISTA DE REGISTRO (Registro nuevo cuestionario incremental) -->
    <div id="registro-view" class="view">
        
        <!-- Botón para volver al inicio -->
        <div class="text-center mt-4">
             <button onclick="navigateTo('consultar')" class="text-sm text-violet-600 hover:underline">&larr; Volver a Consultar</button>
        </div>
        
        <div id="registro-view-container">
            <!-- Barra de Título -->
            <div class="window-title-bar">
                <h1>Registrar nuevo cuestionario incremental</h1>
                <div class="window-controls">
                    <span>_</span><span>&#9633;</span><span>X</span>
                </div>
            </div>

            <!-- Cuerpo de la Ventana -->
            <div class="window-body">
                
                <!-- CAMPOS DE INFO (Fecha y Usuario) -->
                <div class="info-fields">
                    <div class="filter-group">
                        <label for="r-fecha">Fecha:</label>
                        <!-- MODIFICADO: Campo de solo lectura -->
                        <input type="text" id="r-fecha" class="input-text input-readonly" value="dd/mm/aaaa" style="width: 70px;" readonly>
                    </div>
                    <div class="filter-group">
                        <label for="r-usuario">Usuario:</label>
                        <!-- MODIFICADO: Campo de solo lectura -->
                        <input type="text" id="r-usuario" class="input-text input-readonly" value="UsuarioActual" readonly>
                    </div>
                </div>

                <!-- FORMULARIO PRINCIPAL Y DINÁMICO -->
                <div class="flex flex-col gap-4">
                    
                    <!-- Fila 1: Título e Tipo Incremento -->
                    <div class="flex gap-4">
                         <div class="filter-group flex-1">
                            <label for="r-titulo-incremento">Título Incremento:</label>
                            <input type="text" id="r-titulo-incremento" class="input-text flex-1">
                        </div>
                        <div class="filter-group">
                            <label for="r-tipo-incremento">Tipo Incremento:</label>
                            <select id="r-tipo-incremento" class="input-select" onchange="toggleIncrementType(this.value)">
                                <option value="Formativo">Formativo</option>
                                <option value="Final">Final</option>
                            </select>
                        </div>
                    </div>


                    <!-- CONTENIDO DINÁMICO (Banco de preguntas o Cuestionarios Completados) -->
                    <div id="dynamic-content">
                        <!-- Contenido por defecto (Formativo) -->
                        <div id="formativo-section" class="filter-fieldset" style="display: block; gap: 0;">
                            <div class="font-bold mb-2">Banco de preguntas</div>
                            <!-- Filtros del Banco -->
                            <div class="flex gap-4 mb-3 items-center">
                                <div class="filter-group">
                                    <label for="r-unidad">Unidad:</label>
                                    <select id="r-unidad" class="input-select" style="width: 70px;">
                                        <option value="">(Todas)</option>
                                        <option>U-01</option><option>U-02</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="r-estado">Estado:</label>
                                    <select id="r-estado" class="input-select" style="width: 90px;">
                                        <option value="">(Todos)</option>
                                        <option>Activo</option><option>Inactivo</option>
                                    </select>
                                </div>
                                <button class="btn-classic">Buscar</button>
                            </div>
                            
                            <!-- Tabla de preguntas del Banco -->
                            <div class="table-container" style="max-height: 150px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Número</th>
                                            <th>Pregunta</th>
                                            <th>Estado</th>
                                            <th class="col-seleccion">Seleccionar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bank-questions-body">
                                        <!-- Preguntas de ejemplo Formativo -->
                                        <!-- MODIFICADO: Añadidos data-attributes a los checkbox -->
                                        <tr><td>1</td> <td>¿Qué es la dilatación térmica?</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" data-numero="1" data-pregunta="¿Qué es la dilatación térmica?" onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>2</td> <td>Defina el Teorema de Pitágoras.</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" data-numero="2" data-pregunta="Defina el Teorema de Pitágoras." onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>3</td> <td>Leyes de Newton.</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" data-numero="3" data-pregunta="Leyes de Newton." onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>4</td> <td>¿Qué fue la Revolución Francesa?</td> <td>Inactivo</td> <td class="col-seleccion"><input type="checkbox" data-numero="4" data-pregunta="¿Qué fue la Revolución Francesa?" onchange="updateTotalQuestions()"></td></tr>
                                        <tr><td>5</td> <td>Capital de Argentina.</td> <td>Activo</td> <td class="col-seleccion"><input type="checkbox" data-numero="5" data-pregunta="Capital de Argentina." onchange="updateTotalQuestions()"></td></tr>
                                    </tbody>
                                </table>
                            </div>
                            
                        </div>
                        
                        <!-- Contenido para Final (Oculto por defecto) -->
                        <div id="final-section" class="filter-fieldset" style="display: none; flex-direction: column; gap: 0;">
                            <div class="font-bold mb-2">Cuestionarios Completados (Fuente de preguntas con mayor error)</div>
                            
                            <!-- Tabla de Cuestionarios Completados -->
                            <div class="table-container" style="max-height: 150px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Número Cuest.</th>
                                            <th>Unidad</th>
                                            <th>Fecha Completado</th>
                                            <th>Tasa de Error Prom.</th>
                                            <th class="col-seleccion">Seleccionar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="completed-quizzes-body">
                                        <!-- Cuestionarios de ejemplo Final -->
                                        <tr><td>1002</td> <td>U-02</td> <td>11/11/2025</td> <td>65%</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions(true)"></td></tr>
                                        <tr><td>1008</td> <td>U-03</td> <td>15/11/2025</td> <td>80%</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions(true)"></td></tr>
                                        <tr><td>1012</td> <td>U-03</td> <td>19/11/2025</td> <td>45%</td> <td class="col-seleccion"><input type="checkbox" onchange="updateTotalQuestions(true)"></td></tr>
                                    </tbody>
                                </table>
                            </div>
                             <div class="text-xs text-gray-600 mt-1">
                                Nota: Al crear, se seleccionarán automáticamente las preguntas con la mayor tasa de error de los cuestionarios marcados.
                            </div>
                        </div>
                    </div>


                    <!-- Fila 2: Totales, Calificación y Opciones de Preguntas -->
                    <div class="flex flex-col gap-2 p-2" style="border: 1px dashed #C0C0C0;">
                        <div class="flex gap-10 items-center">
                            <div class="filter-group">
                                <label for="r-total-preguntas">Total preguntas seleccionadas:</label>
                                <input type="text" id="r-total-preguntas" class="input-text input-readonly" value="0" readonly style="width: 40px; background-color: #F0F0F0;">
                            </div>
                        </div>
                        
                        <div class="flex gap-4 items-center">
                            <div class="filter-group">
                                <label for="r-calif-total">Calificación Total:</label>
                                <input type="text" id="r-calif-total" class="input-text" value="" style="width: 60px;">
                            </div>
                             <div class="filter-group">
                                <label for="r-tipo-puntaje">Tipo Puntaje:</label>
                                <select id="r-tipo-puntaje" class="input-select" style="width: 90px;">
                                    <option>Porcentaje</option>
                                    <option>Puntos</option>
                                </select>
                            </div>
                            <div class="filter-group ml-8">
                                <label>Ordenar preguntas al azar:</label>
                                <input type="radio" name="order-type" checked>
                            </div>
                            <div class="filter-group">
                                <label>Barajar respuestas:</label>
                                <input type="radio" name="order-type">
                            </div>
                        </div>

                        <div class="flex justify-center mt-3">
                            <button id="btnCrear" class="btn-classic" style="font-weight: bold; background-color: #D6D6A8;" onclick="toggleQuestionEditor()">Crear</button>
                        </div>
                    </div>


                    <!-- ÁREA DE EDICIÓN DE PREGUNTAS (Visible solo tras "Crear") -->
                    <!-- MODIFICADO: Se quitan las preguntas estáticas y se añade un contenedor dinámico -->
                    <div id="question-editor" class="question-editor-container" style="display:none;">
                        <div class="font-bold text-base mb-2">Detalle de Preguntas Generadas:</div>
                        
                        <!-- El contenido se generará dinámicamente aquí -->
                        <div id="dynamic-question-list" style="max-height: 350px; overflow-y: auto; padding-right: 5px; border: 1px solid #C0C0C0; padding: 5px; background-color: #F8F8F0;">
                            <!-- Las preguntas generadas por JS irán aquí -->
                        </div>

                        <!-- Botones de Acción -->
                        <div class="flex justify-end gap-2 mt-4">
                            <button class="btn-classic" onclick="toggleQuestionEditor(true)">Cancelar</button>
                            <button class="btn-classic" style="font-weight: bold; background-color: #B2D8B2;">Confirmar</button>
                        </div>
                    </div>


                </div>
                
                <!-- Barra de Pie de página -->
                <div class="footer-bar mt-4">
                    <button class="btn-classic" onclick="navigateTo('inicio')">Salir</button>
                    <button class="btn-classic" style="font-weight: bold;">confirmar registracion nuevo cuestionario incremental</button>
                </div>

            </div>
        </div>
    </div>


    <!-- VISTA DE HABILITACIÓN (NUEVA) -->
    <div id="habilitacion-view" class="view">
        
        <!-- Botón para volver al inicio -->
        <div class="text-center mt-4">
             <button onclick="navigateTo('consultar')" class="text-sm text-violet-600 hover:underline">&larr; Volver a Consultar</button>
        </div>
        
        <!-- Contenedor de la Ventana -->
        <div id="habilitacion-view-container">
            <!-- Barra de Título -->
            <div class="window-title-bar">
                <h1>Registrar habilitación de cuestionario incremental</h1>
                <div class="window-controls">
                    <span>_</span><span>&#9633;</span><span>X</span>
                </div>
            </div>

            <!-- Cuerpo de la Ventana -->
            <div class="window-body">
                
                <!-- 1. Cuestionario Seleccionado -->
                <fieldset class="filter-fieldset">
                    <legend>Cuestionario seleccionado</legend>
                    <div class="filter-group">
                        <label>Cuestionario:</label>
                        <input type="text" class="input-text input-readonly" value="1001" readonly style="width: 50px;">
                    </div>
                    <div class="filter-group">
                        <label>Materia:</label>
                        <input type="text" class="input-text input-readonly" value="Materia Ejemplo" readonly style="width: 150px;">
                    </div>
                     <div class="filter-group">
                        <label>Unidad:</label>
                        <input type="text" class="input-text input-readonly" value="U-01" readonly style="width: 40px;">
                    </div>
                </fieldset>

                <!-- Contenedor de dos columnas (Flex) -->
                <div class="flex flex-wrap md:flex-nowrap gap-4">
                
                    <!-- Columna Izquierda: Configuración General -->
                    <div class="flex-1 w-full md:w-1/2">
                        <fieldset class="filter-fieldset" style="height: 100%; flex-direction: column; align-items: flex-start;">
                            <legend>Configuración General</legend>
                            <div class="filter-group w-full">
                                <label for="h-desc" style="align-self: flex-start; margin-top: 4px;">Descripción:</label>
                                <textarea id="h-desc" class="input-text" style="width: 100%; height: 60px; min-width: 200px;"></textarea>
                            </div>
                            <div class="filter-group w-full mt-2" style="flex-wrap: wrap;">
                                <input type="checkbox" id="h-req-pass" onchange="document.getElementById('h-pass').disabled = !this.checked; document.getElementById('h-pass').classList.toggle('input-readonly', !this.checked);">
                                <label for="h-req-pass">Requiere Contraseña:</label>
                                <label for="h-pass" style="margin-left: 10px;">Contraseña:</label>
                                <input type="password" id="h-pass" class="input-text input-readonly" style="width: 120px;" disabled>
                            </div>
                        </fieldset>
                    </div>
                    
                    <!-- Columna Derecha: Detalles y Validez -->
                    <div class="flex-1 w-full md:w-1/2 flex flex-col gap-3">
                        <fieldset class="filter-fieldset" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                            <legend>Detalles de Habilitación</legend>
                            <div class="filter-group">
                                <label style="width: 110px;">Usuario que habilita:</label>
                                <input type="text" class="input-text input-readonly" value="AdminSystem" readonly>
                            </div>
                            <div class="filter-group">
                                <label style="width: 110px;">Fecha de Habilitación:</label>
                                <input type="text" class="input-text" value="13/11/2025" style="width: 80px;"> <!-- Simular datepicker -->
                            </div>
                             <div class="filter-group">
                                <label style="width: 110px;">Horario Habilitación:</label>
                                <input type="text" class="input-text" value="09:00" style="width: 50px;"> <!-- Simular timepicker -->
                            </div>
                        </fieldset>
                        
                        <fieldset class="filter-fieldset" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                            <legend>Periodo de validez</legend>
                            <div class="filter-group">
                                <label style="width: 110px;">Fecha de caducidad:</label>
                                <input type="text" class="input-text" value="20/11/2025" style="width: 80px;">
                            </div>
                             <div class="filter-group">
                                <label style="width: 110px;">Horario de caducidad:</label>
                                <input type="text" class="input-text" value="23:59" style="width: 50px;">
                            </div>
                        </fieldset>
                    </div>
                </div>

                <!-- 3. Preguntas del cuestionario -->
                 <fieldset class="filter-fieldset mt-3" style="flex-direction: column;">
                    <legend>Preguntas del cuestionario</legend>
                    <div class="table-container" style="max-height: 200px; margin-bottom: 0;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ítem</th>
                                    <th>Pregunta</th>
                                    <th>Respuesta</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Datos de ejemplo de la imagen -->
                                <tr><td>1</td><td>¿Qué es el Big Bang?</td><td>Expansión inicial del universo.</td><td>Activa</td></tr>
                                <tr><td>2</td><td>Capital de Chile.</td><td>Santiago.</td><td>Activa</td></tr>
                                <tr><td>3</td><td>Fórmula del agua.</td><td>H2O</td><td>Activa</td></tr>
                                <tr><td>4</td><td>¿Quién escribió El Quijote?</td><td>Miguel de Cervantes</td><td>Activa</td></tr>
                                <tr><td>5</td><td>¿Cuántos huesos tiene el cuerpo humano adulto?</td><td>206</td><td>Activa</td></tr>
                                <tr><td>6</td><td>¿Qué es la fotosíntesis?</td><td>Proceso vegetal...</td><td>Activa</td></tr>
                                 <tr><td>7</td><td>(Pregunta de ejemplo)</td><td>(Respuesta de ejemplo)</td><td>Activa</td></tr>
                                <tr><td>8</td><td>(Pregunta de ejemplo)</td><td>(Respuesta de ejemplo)</td><td>Activa</td></tr>
                            </tbody>
                        </table>
                    </div>
                </fieldset>

                <!-- Barra de Pie de página -->
                <div class="footer-bar">
                    <button class="btn-classic" onclick="navigateTo('consultar')">Cancelar</button>
                    <button class="btn-classic" style="font-weight: bold;">Registrar confirmacion de habilitacion de cuestionario incremental</button>
                </div>

            </div>
        </div>
    </div>

   
    <!-- MODAL DE ERROR (NUEVO) -->
    <div id="error-modal" class="modal-overlay">
        <div class="modal-window">
            <!-- Barra de Título (simulada) -->
            <div class="window-title-bar">
                <h1>Error de validación</h1>
                <div class="window-controls">
                    <span>X</span>
                </div>
            </div>
            <div class="modal-body">
                <p id="error-message">Mensaje de error irá aquí.</p>
                <div class="footer-bar" style="border-top: none;">
                    <button class="btn-classic" onclick="cerrarError()">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

     
    <!-- JavaScript para Lógica de Vistas y Dinámicas -->
    <script>
        // Inicializa el total de seleccionados en la vista de consulta
        document.addEventListener('DOMContentLoaded', () => {
             updateTotalSelected();
             // Asignar fecha actual al campo de registro (simulado)
             const dateFields = [document.getElementById('r-fecha'), document.getElementById('f-fecha')];
             const today = new Date();
             const d = String(today.getDate()).padStart(2, '0');
             const m = String(today.getMonth() + 1).padStart(2, '0');
             const y = today.getFullYear();
             const formattedDate = `${d}/${m}/${y}`;
             
             dateFields.forEach(field => {
                 if (field && (field.value === 'dd/mm/aaaa' || field.value === '')) {
                     field.value = formattedDate;
                 }
             });
        });

        // 1. Lógica de Navegación de Vistas
        function navigateTo(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            const targetView = document.getElementById(viewId + '-view');
            if (targetView) {
                targetView.classList.add('active');
            }
        }
        
        // 2. Lógica para actualizar el contador de seleccionados en la vista de CONSULTAR
        function updateTotalSelected() {
            const checkboxes = document.querySelectorAll('#consultar-view-container input[type="checkbox"]');
            let count = 0;
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    count++;
                }
            });
            const totalInput = document.getElementById('f-total');
            if (totalInput) {
                totalInput.value = count;
            }
        }

        // --- NUEVAS FUNCIONES PARA MODAL DE ERROR ---
        function mostrarError(mensaje) {
            const modal = document.getElementById('error-modal');
            const messageP = document.getElementById('error-message');
            if (modal && messageP) {
                messageP.textContent = mensaje;
                modal.style.display = 'flex'; // Usamos flex para centrar
            }
        }

        function cerrarError() {
            const modal = document.getElementById('error-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        // --- FIN DE FUNCIONES DE MODAL ---


        // --- NUEVA FUNCIÓN DE VALIDACIÓN (HABILITACIÓN) ---
        function validarYHabilitar() {
            const totalInput = document.getElementById('f-total');
            let count = 0;
            
            if (totalInput) {
                count = parseInt(totalInput.value, 10);
            }

            if (isNaN(count)) {
                count = 0; // Tratar NaN como 0
            }

            if (count === 0) {
                mostrarError('Debe seleccionar al menos un cuestionario para habilitar.');
                return; // Detener ejecución
            }
            
            if (count > 1) {
                mostrarError('Solo puede habilitar un cuestionario a la vez. Por favor, seleccione solo uno.');
                return; // Detener ejecución
            }

            // Si count es 1, navegar
            if (count === 1) {
                // (Opcional: aquí se podría tomar el ID del seleccionado y pasarlo a la vista de habilitación)
                navigateTo('habilitacion');
            }
        }


        // 3. Lógica dinámica para la vista de REGISTRO (Formativo vs. Final)
        function toggleIncrementType(type) {
            const formativoSection = document.getElementById('formativo-section');
            const finalSection = document.getElementById('final-section');
            const editor = document.getElementById('question-editor');

            editor.style.display = 'none'; // Ocultar editor al cambiar de tipo

            if (type === 'Final') {
                formativoSection.style.display = 'none';
                finalSection.style.display = 'flex';
            } else { // Formativo
                formativoSection.style.display = 'block';
                finalSection.style.display = 'none';
            }
            // Recalcular total de preguntas seleccionadas
            updateTotalQuestions();
        }

        // 4. Lógica para actualizar el contador de preguntas en la vista de REGISTRO
        function updateTotalQuestions(isFinal = false) {
            let selector = '#formativo-section input[type="checkbox"]';
            if (document.getElementById('r-tipo-incremento').value === 'Final' || isFinal) {
                // En modo Final, contamos los cuestionarios seleccionados como "preguntas" fuente
                selector = '#final-section input[type="checkbox"]';
            }
            
            const checkboxes = document.querySelectorAll(selector);
            let count = 0;
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    count++;
                }
            });

            const totalInput = document.getElementById('r-total-preguntas');
            if (totalInput) {
                // Para el modo formativo, el total es el número de preguntas a crear.
                // Para el modo final, el total es el número de cuestionarios fuente.
                totalInput.value = count;
            }
        }
        
        // 5. Lógica para mostrar/ocultar el Editor de Preguntas
        // MODIFICADO: Lógica de creación dinámica
        function toggleQuestionEditor(cancel = false) {
            const editor = document.getElementById('question-editor');
            const listContainer = document.getElementById('dynamic-question-list');
            const btnCrear = document.getElementById('btnCrear');
            const tipo = document.getElementById('r-tipo-incremento').value;

            // Lógica de CANCELAR o RECARGAR
            if (editor.style.display === 'block' || cancel) {
                 editor.style.display = 'none';
                 btnCrear.textContent = 'Crear';
                 listContainer.innerHTML = ''; // Limpiar el contenedor
                 return;
            }
            
            // --- Lógica de CREAR ---
            listContainer.innerHTML = ''; // Limpiar siempre antes de crear

            if (tipo === 'Formativo') {
                // 1. Obtener preguntas seleccionadas del banco
                const selectedQuestions = document.querySelectorAll('#formativo-section input[type="checkbox"]:checked');
                
                if (selectedQuestions.length === 0) {
                    mostrarError('Debe seleccionar al menos una pregunta del banco para crear un cuestionario formativo.');
                    return;
                }

                let questionIndex = 1;
                selectedQuestions.forEach(chk => {
                    const questionText = chk.dataset.pregunta;
                    // 2. Generar el HTML para cada pregunta seleccionada
                    const questionHtml = crearHtmlEditorPregunta(questionIndex, questionText, '', false);
                    listContainer.insertAdjacentHTML('beforeend', questionHtml);
                    questionIndex++;
                });

            } else { // tipo === 'Final'
                // 1. Obtener cuestionarios fuente seleccionados
                const selectedQuizzes = document.querySelectorAll('#final-section input[type="checkbox"]:checked');
                
                if (selectedQuizzes.length === 0) {
                    mostrarError('Debe seleccionar al menos un cuestionario completado como fuente para el tipo "Final".');
                    return;
                }
                
                // 2. Simular la lógica de backend (crear preguntas con tasa de error)
                listContainer.innerHTML = `<div class="p-2 text-xs text-gray-700" style="margin-bottom: 5px; background-color: #FFF; border: 1px dashed #AAA;"><i><b>Simulación:</b> Creando cuestionario con preguntas de mayor tasa de error de los ${selectedQuizzes.length} cuestionarios fuente seleccionados. El profesor puede revisar y ajustar puntajes.</i></div>`;
                
                // Añadir 2-3 preguntas simuladas (el texto es solo lectura)
                listContainer.insertAdjacentHTML('beforeend', crearHtmlEditorPregunta(1, "Pregunta Simulada (Error 80%): ¿Qué fue la Revolución Francesa?", "10", true));
                listContainer.insertAdjacentHTML('beforeend', crearHtmlEditorPregunta(2, "Pregunta Simulada (Error 65%): Leyes de Newton.", "10", true));
                listContainer.insertAdjacentHTML('beforeend', crearHtmlEditorPregunta(3, "Pregunta Simulada (Error 60%): Capital de Argentina.", "5", true));
            }

            // 3. Mostrar el editor y cambiar el botón
            editor.style.display = 'block';
            btnCrear.textContent = 'Recargar Editor';
        }

        // NUEVA FUNCIÓN: Helper para crear el HTML del editor de preguntas
        function crearHtmlEditorPregunta(index, questionText, puntaje = '', isFinal = false) {
            // Si es 'Final', la pregunta es solo lectura (simulación)
            const readOnlyAttr = isFinal ? 'readonly class="input-text input-readonly"' : 'class="input-text"';
            const puntajeValue = puntaje || '';
            
            return `
            <div class="question-item border p-2 mb-3 bg-white" style="border: 1px solid #999;">
                <div class="question-row-header">
                    <div class="flex gap-2 flex-wrap">
                        <label style="width: 100px;">Número Pregunta:</label>
                        <input type="text" class="input-text input-readonly" value="${index}" style="width: 30px;" readonly>
                        <label>Obligatorio:</label>
                        <input type="checkbox" checked>
                        <label style="margin-left: 20px;">Puntaje:</label>
                        <input type="text" class="input-text" style="width: 40px;" value="${puntajeValue}">
                    </div>
                </div>
                <div class="question-row mt-2">
                    <label style="width: 150px;">Nombre Pregunta:</label>
                    <input type="text" ${readOnlyAttr} value="${questionText}" style="flex: 1;">
                    <button class="btn-classic">Registrar Imagen</button>
                </div>
                <!-- Respuestas para que el profesor llene -->
                <div class="mt-2 ml-4 p-2 border-l border-dashed border-gray-400">
                    <div class="question-row">
                        <label class="field-label">1. Respuesta:</label>
                        <input type="text" class="input-text flex-1" value="">
                        <label>Porcentaje:</label>
                        <input type="text" class="input-text" style="width: 40px;">%
                        <label>Retro:</label>
                        <input type="text" class="input-text flex-1">
                        <input type="checkbox">
                    </div>
                    <div class="question-row">
                        <label class="field-label">2. Respuesta:</label>
                        <input type="text" class="input-text flex-1" value="">
                        <label>Porcentaje:</label>
                        <input type="text" class="input-text" style="width: 40px;">%
                        <label>Retro:</label>
                        <input type="text" class="input-text flex-1">
                        <input type="checkbox">
                    </div>
                    <div class="question-row">
                        <label class="field-label" style="font-style: italic;">n. Respuesta:</label>
                        <input type="text" class="input-text flex-1" value="">
                        <label>Porcentaje:</label>
                        <input type="text" class="input-text" style="width: 40px;">%
                        <label>Retro:</label>
                        <input type="text" class="input-text flex-1">
                        <input type="checkbox">
                    </div>
                </div>
            </div>
            `;
        }
        
        // Inicializar la vista dinámica y el contador
        window.onload = function() {
            toggleIncrementType(document.getElementById('r-tipo-incremento').value);
            updateTotalSelected();
            
            // Simular fecha actual en más campos
             const dateFields = [document.getElementById('r-fecha'), document.getElementById('f-fecha')];
             const today = new Date();
             const d = String(today.getDate()).padStart(2, '0');
             const m = String(today.getMonth() + 1).padStart(2, '0');
             const y = today.getFullYear();
             const formattedDate = `${d}/${m}/${y}`;
             
             dateFields.forEach(field => {
                 if (field && (field.value === 'dd/mm/aaaa' || field.value === '')) {
                     field.value = formattedDate;
                 }
             });
        };
    </script>

</body>
</html>
